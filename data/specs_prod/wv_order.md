we_mart.wv_order
================

# BASIC INFO

|**About**| |
| :--- | :--- |
|**Database**|**we_mart**|
|**Table Type**|MART PRIMARY|
|**Partitioned by**| |
|**Created/ Last Updated At**|2021-11-29 / 2024-08-02|
|**Created By**|박상민|
|**Last Updated By**|송재영|
|**Collaborators**|송재영[70], 이현지[5], 구민서[1], 박상민[1]|

#### Change History
|**Date**|**By**|**LINK**|
| :--- | :--- | :--- |
|2021-11-29|박상민|[PR](https://github.com/benxcorp/databricks/commit/8dc809154614d40353684e2d2023adee4ec47cef)|
|2021-12-02|송재영|[PR](https://github.com/benxcorp/databricks/commit/3dc908757dc22cc71a5c03f3eb50e4814c6780de)|
|2021-12-02|송재영|[PR](https://github.com/benxcorp/databricks/commit/78b32586086e2f5693131462873709d6ce55004d)|
|2021-12-08|송재영|[PR](https://github.com/benxcorp/databricks/commit/240f3a7f93dbe8ed1909e353811c09624e494bc2)|
|2021-12-09|이현지|[PR](https://github.com/benxcorp/databricks/commit/a0c16623d4d93e8580660e07a05bcdb9d834b2f5)|
|2021-12-16|송재영|[PR](https://github.com/benxcorp/databricks/commit/18a0ca2a761594a21a4d23f29b9a5094fc591492)|
|2021-12-16|송재영|[PR](https://github.com/benxcorp/databricks/commit/c98a923573d201e2d4b854cb4878f3de267045c5)|
|2021-12-16|송재영|[PR](https://github.com/benxcorp/databricks/commit/24bbee68caef08935edcc121857771062e2cb7fe)|
|2022-01-03|송재영|[PR](https://github.com/benxcorp/databricks/commit/c40703e87e5a75b2be2085bd7b86a8fd49e31980)|
|2022-01-03|송재영|[PR](https://github.com/benxcorp/databricks/commit/f368f5071602a3fcc11070012c8ec788822af400)|
|2022-01-06|송재영|[PR](https://github.com/benxcorp/databricks/commit/e426de9b1387e2cbbd7c2daddbefdacc975d4cc6)|
|2022-01-06|송재영|[PR](https://github.com/benxcorp/databricks/commit/7b12ee1243ef29d0e266f71d46ee89a58e294fbd)|
|2022-01-18|송재영|[PR](https://github.com/benxcorp/databricks/commit/ecf2b9c150b165d72df05ae543dea8eb76c3cf77)|
|2022-01-28|송재영|[PR](https://github.com/benxcorp/databricks/commit/88d56b496d1e6a4f9e619a6893ef466927c21f6b)|
|2022-03-17|송재영|[PR](https://github.com/benxcorp/databricks/commit/39fee16ecfa66b94a860e633a6bf63ff07920977)|
|2022-03-30|송재영|[PR](https://github.com/benxcorp/databricks/commit/6a34bcfa1c473b85f69eccaf92f55c3cb480905d)|
|2022-03-31|송재영|[PR](https://github.com/benxcorp/databricks/commit/945d1c0c5ca331ae000e130bcff338540d816556)|
|2022-04-18|송재영|[PR](https://github.com/benxcorp/databricks/commit/b5409fdf9f8c40c1a4fd4472958c3a2cfd6068dd)|
|2022-06-21|이현지|[PR](https://github.com/benxcorp/databricks/commit/4de5d0a511e4aea4096e4e68957053d954f979fb)|
|2022-07-04|이현지|[PR](https://github.com/benxcorp/databricks/commit/b33b293999a93a3966c6b94c919b26de2c1173b5)|
|2022-07-04|이현지|[PR](https://github.com/benxcorp/databricks/commit/f20547c57a3c2eb877ea7c9b24a05324338ae1da)|
|2022-07-18|송재영|[PR](https://github.com/benxcorp/databricks/commit/6431d379d2f752681926c82ca894169fcba52e82)|
|2022-07-18|송재영|[PR](https://github.com/benxcorp/databricks/commit/fb813b8af5247d3c0dfdf1f96bab08afe0c8ceb4)|
|2022-07-18|송재영|[PR](https://github.com/benxcorp/databricks/commit/efd64885f4879826fa359f0d482817c41e8d124f)|
|2022-07-18|송재영|[PR](https://github.com/benxcorp/databricks/commit/6c380688a5f4f1ba2490b1639833d425698d8dce)|
|2022-07-18|송재영|[PR](https://github.com/benxcorp/databricks/commit/d93442b341ce83dba80a709e35186174235d12df)|
|2022-07-18|송재영|[PR](https://github.com/benxcorp/databricks/commit/4f0d9990dab48f84d64430fe277f97d90629dba3)|
|2022-07-18|송재영|[PR](https://github.com/benxcorp/databricks/commit/7a07813310ee72dc50b8e12cb200bd07fc4f9dcb)|
|2022-07-18|송재영|[PR](https://github.com/benxcorp/databricks/commit/8d533fbfb8bff7e7ea4709869b4f58316a68257e)|
|2022-07-18|송재영|[PR](https://github.com/benxcorp/databricks/commit/c9c8d3c345863d76a112bc3f54d6b8ff85e8ce99)|
|2022-07-19|송재영|[PR](https://github.com/benxcorp/databricks/commit/b7f11df2a981ba8bece5a2ac2f223cd227d08cef)|
|2022-07-19|송재영|[PR](https://github.com/benxcorp/databricks/commit/24022091500c619ad4b06cb36d2e232522c4272e)|
|2022-07-19|송재영|[PR](https://github.com/benxcorp/databricks/commit/a1ac4daae7bc343c1423c57f7e3a70e2c557099a)|
|2022-07-22|송재영|[PR](https://github.com/benxcorp/databricks/commit/8b40148eaece2e97100f283b840fb5e006ba7d82)|
|2022-07-25|이현지|[PR](https://github.com/benxcorp/databricks/commit/30f9196bb50dc5a16a9a8698bf3197edb1dc78b7)|
|2022-07-27|송재영|[PR](https://github.com/benxcorp/databricks/commit/a4b30c75b75036da4cf4b3422dc68718d9796613)|
|2022-07-27|송재영|[PR](https://github.com/benxcorp/databricks/commit/1de80a357ac41657ee9ed6ddd0f01fb105e4d1cb)|
|2022-07-27|송재영|[PR](https://github.com/benxcorp/databricks/commit/3de048601b9020fc4d69a5a55b5723b57f89d5ce)|
|2022-07-27|송재영|[PR](https://github.com/benxcorp/databricks/commit/1abbd3443b48cb9cbd739fb8ca6290889410ac86)|
|2022-07-27|송재영|[PR](https://github.com/benxcorp/databricks/commit/7e8385b0288822fa5dba79b25bafe1b37e6bf508)|
|2022-07-27|송재영|[PR](https://github.com/benxcorp/databricks/commit/96c133709c815ef65c9864bf7e2fbd478a7a524b)|
|2022-10-05|송재영|[PR](https://github.com/benxcorp/databricks/commit/f52639fc216d0f0de3f541a79bb027ab81a9bb58)|
|2022-10-05|송재영|[PR](https://github.com/benxcorp/databricks/commit/ad7a5e7a3807ba368295dd351570629420fc6501)|
|2022-11-03|송재영|[PR](https://github.com/benxcorp/databricks/commit/ce4fbc5a20a16bf23f78afcb2d0572ffe155957a)|
|2022-11-03|송재영|[PR](https://github.com/benxcorp/databricks/commit/e0d1da87162e31a84eae9f7a98620b9dd3dd683c)|
|2022-11-23|송재영|[PR](https://github.com/benxcorp/databricks/commit/e833469c89dce2452ac22b7b029c2f2483cc4155)|
|2022-11-24|송재영|[PR](https://github.com/benxcorp/databricks/commit/d7b056c34114d77bf0ba7dd8a1435145739ec73d)|
|2022-12-09|구민서|[PR](https://github.com/benxcorp/databricks/commit/bd183779c84e616084e05627330a1c8b98ca44bd)|
|2023-03-13|송재영|[PR](https://github.com/benxcorp/databricks/commit/759e922afbb9f92d2e9fba0f37e492c7ee2c4661)|
|2023-04-12|송재영|[PR](https://github.com/benxcorp/databricks/commit/bbb80f358652792b8efa0b5a46034468078c2b6d)|
|2023-04-27|송재영|[PR](https://github.com/benxcorp/databricks/commit/07154e9ff926d600423820ea8e605cf5a569a1cb)|
|2023-05-19|송재영|[PR](https://github.com/benxcorp/databricks/commit/600a8828283884bf213d05ee8f092e0170282b68)|
|2023-06-12|송재영|[PR](https://github.com/benxcorp/databricks/commit/92d52fded71d7111678382b27e880f317933ae55)|
|2023-06-15|송재영|[PR](https://github.com/benxcorp/databricks/commit/cb5fae3bce7a33d2a4419f0c60fa1f22d59f193d)|
|2023-06-15|송재영|[PR](https://github.com/benxcorp/databricks/commit/32093eda71286fae55645f0787a204f872161d72)|
|2023-07-19|송재영|[PR](https://github.com/benxcorp/databricks/commit/302e1fba9446244f923b91b1e3f774e24bb041b1)|
|2023-07-24|송재영|[PR](https://github.com/benxcorp/databricks/commit/ccd503a9ff46ddae0243f8162790b9b19269e09f)|
|2023-07-24|송재영|[PR](https://github.com/benxcorp/databricks/commit/552913b3f3b63007bd4c54461312ff3d8a3521c2)|
|2023-07-31|송재영|[PR](https://github.com/benxcorp/databricks/commit/654d3851c9b0abe6c52f400de519f0a563faf322)|
|2023-09-18|송재영|[PR](https://github.com/benxcorp/databricks/commit/3c2c65e38e77ea09f4105682f3041fbb223f785c)|
|2023-09-20|송재영|[PR](https://github.com/benxcorp/databricks/commit/5f7b4b87860fbed08d471876f7ea886a8d3554a4)|
|2023-09-20|송재영|[PR](https://github.com/benxcorp/databricks/commit/1c6f71f7fffaecbbd001dd4b9158519ea7e70e22)|
|2023-09-20|송재영|[PR](https://github.com/benxcorp/databricks/commit/732e35010328b4108adaeee434bd5c70c865dccd)|
|2023-11-09|송재영|[PR](https://github.com/benxcorp/databricks/commit/352bb2c1389b350e07eec8912cdb846ed51ccb76)|
|2023-11-16|송재영|[PR](https://github.com/benxcorp/databricks/commit/2aa87eafd6f19e6d9ab56ec6f95322916f0fd9ca)|
|2023-12-04|송재영|[PR](https://github.com/benxcorp/databricks/commit/ed356b181240fa339a49093f94d545c388af7896)|
|2024-01-18|송재영|[PR](https://github.com/benxcorp/databricks/commit/0d2d05bd03e48d89e5be43312e126b19a450853c)|
|2024-01-18|송재영|[PR](https://github.com/benxcorp/databricks/commit/dcac53cb3df8ff3f9e0a36a86f21dbcea027a406)|
|2024-03-19|송재영|[PR](https://github.com/benxcorp/databricks/commit/b2570667b137e95b76858070a29e1e44da039113)|
|2024-05-30|송재영|[PR](https://github.com/benxcorp/databricks/commit/f0d3c4ba3262ea1ef26037a5d1d8695930bec7a4)|
|2024-05-30|송재영|[PR](https://github.com/benxcorp/databricks/commit/513fb33efe109ee81d45bbcadd57d4a04567f2d9)|
|2024-05-30|송재영|[PR](https://github.com/benxcorp/databricks/commit/9bd7cbca546a106f5400ae979b74fecc5c622196)|
|2024-05-30|송재영|[PR](https://github.com/benxcorp/databricks/commit/e211995c5fa4e9df5bee77ae30f03a93e66cd89e)|
|2024-07-01|송재영|[PR](https://github.com/benxcorp/databricks/commit/4f06e9b9ef59c8bcaefe6b79d759edb90dcbd60a)|
|2024-07-02|송재영|[PR](https://github.com/benxcorp/databricks/commit/21da1795061451c1397d4b388a87e68712a3483e)|
|2024-07-23|송재영|[PR](https://github.com/benxcorp/databricks/commit/6d83b7ce51c92f350ecb13622669d5a80dec15bb)|
|2024-08-02|송재영|[PR](https://github.com/benxcorp/databricks/commit/c1838a3cd9ebe6c97eef2b39252df4ba4f644a5c)|


# TABLE NOTICE

### 테이블 개요

* **테이블 목적**: 위버스 플랫폼에서 발생하는 유료 결제 현황 데이터를 집계하여 저장. 젤리, 인앱, 위버스샵 결제 데이터 통합.
* **데이터 레벨**: TRANSACTIONAL DATA
* **파티션 키**: `pay_dt`
* **주요 키**: `transaction_id`

### 테이블 특징

* 젤리, 인앱, 위버스샵 결제 데이터를 통합하여 사용자별 결제 내역을 한눈에 확인 가능.
* `is_pay`, `is_cx`, `is_partial_cx`, `is_cx_to_jelly_refund` 컬럼을 통해 결제, 취소, 부분 환불, 젤리 환불 여부를 구분하여 분석 가능.
* `seq_pay_completed`, `seq_all` 컬럼을 통해 유저별 결제 내역 순서를 파악하여 분석 가능.
* `is_fc` 컬럼을 통해 팬클럽 가입 여부를 파악하여 분석 가능.
* 젤리 구매 금액의 경우, `paid_amt_krw`, `paid_amt_krw_inner` 컬럼을 통해 내부 단가로 계산된 결제 금액을 확인 가능.

### 데이터 추출 및 생성 과정

1. **주요 데이터 소스**:
    * `we_mart_wv1.wv_order_with_sale_id`: 위버스 1.0 버전 유저 결제 데이터
    * `inapp_orders_pre`: 인앱 구매 데이터
    * `JELLY_ORDERS`: 젤리 구매 데이터
    * `INAPP_SHOP_ORDERS`: 인앱 및 위버스샵 구매 데이터
    * `we_meta.we_artist`: 아티스트 정보
    * `we_meta.we_media_product`: 미디어 상품 정보
    * `we_meta.we_digital_product`: 디지털 상품 정보
    * `we_mart.we_user`: 위버스 유저 정보
    * `we_mart.ws_fc_user_history`: 위버스샵 팬클럽 가입 정보
    * `we_meta.currency_rate`: 환율 정보
    * `CTRY`: 위버스 유저 국가 정보
2. **데이터 전처리**:
    * 각 데이터 소스에서 필요한 컬럼만 추출하여 전처리.
    * 인앱 구매 데이터는 `inapp_orders_pre` 뷰를 통해 젤리 상품 제외 및 `pur_confirmed_dt` 컬럼 생성.
    * 젤리 구매 데이터는 `JELLY_ORDERS` 뷰를 통해 `paid_amt_krw`, `paid_amt_krw_inner` 컬럼 생성.
    * 젤리, 인앱, 위버스샵 구매 데이터를 `INAPP_SHOP_ORDERS` 뷰를 통해 통합.
3. **데이터 통합**:
    * `INAPP_SHOP_ORDERS` 뷰와 `JELLY_ORDERS` 뷰를 `ORDS` 뷰를 통해 통합.
    * `CTRY`, `FC` 뷰를 조인하여 국가 정보 및 팬클럽 가입 정보를 추가.
4. **최종 테이블 생성**:
    * `ORDS` 뷰에서 필요한 컬럼을 추출하여 `we_mart.wv_order` 테이블 생성.
    * `pay_dt` 컬럼을 파티션 키로 활용.

### 테이블 활용 가이드

* **주요 활용**:
    * 위버스 플랫폼에서 발생하는 유료 결제 현황 분석
    * 젤리, 인앱, 위버스샵 결제 데이터 통합 분석
    * 유저별 결제 내역, 취소 내역, 환불 내역 분석
    * 팬클럽 가입 여부와 결제 현황 분석
    * 국가별 결제 현황 분석
* **조인 시 유의사항**:
    * `we_member_id`, `wv_user_id`, `transaction_id`, `purchase_id`, `product_id`, `we_art_id`, `comm_id` 등의 컬럼을 사용하여 다른 테이블과 조인 가능.
    * `pay_dt` 컬럼을 사용하여 시간 기반으로 다른 테이블과 조인 가능.
    * `is_pay`, `is_cx`, `is_partial_cx`, `is_cx_to_jelly_refund`, `is_fc` 등의 컬럼을 사용하여 조건을 걸어 분석 가능.

### 추가 정보

* 젤리 구매 금액의 경우, `paid_amt_krw`, `paid_amt_krw_inner` 컬럼을 통해 내부 단가로 계산된 결제 금액을 확인 가능.
* `run_timestamp` 컬럼을 통해 데이터 생성 시간 확인 가능.
* `we_mart.wv_order` 테이블은 `pay_dt` 컬럼을 파티션 키로 활용하여 데이터 접근 및 처리 효율성을 높임.
* 이 테이블은 `we_mart` 스키마에 저장됨.
---
# COLUMN INFO

|#|Column Name|Data Type|Comment|
| :--- | :--- | :--- | :--- |
|0|we_member_id|bigint|위버스 플랫폼 통합 유저의 ID|
|1|wv_user_id|bigint|위버스 유저 ID|
|2|ctry_code|string|국가 코드|
|3|is_pay|int|구매 여부|
|4|pay_dt|timestamp|구매(=결제) 시점|
|5|is_cx|int|취소 여부|
|6|is_partial_cx|int|(젤리의 경우) 부분 환금(취소) 여부|
|7|is_cx_to_jelly_refund|int|(젤리의 경우) 젤리 환불에 의한 환급 여부|
|8|cx_dt|timestamp|구매 취소 시점|
|9|transaction_id|string|구매 별 거래 id(key)|
|10|purchase_id|string|영수증 구매 테이블 id|
|11|ord_status|string|주문 상태|
|12|product_type|string|디지털 상품 종류|
|13|product_id|int|상품 ID, data_source에 따라 unique|
|14|is_media_product|int|미디어 상품일 경우|
|15|we_art_id|int|위버스 플랫폼 통합 아티스트/커뮤니티 ID|
|16|we_art_name|string|위버스 플랫폼 통합 아티스트/커뮤니티 명|
|17|comm_id|bigint|위버스 커뮤니티 ID|
|18|product_name|string|디지털 상품 명|
|19|dur_type|string|구매상품 적용 단위 및 유형|
|20|dur_unit|string|구매상품 유형에 따른 단위|
|21|dur_value|int|구매상품 단위에 따른 적용 값|
|22|promotion_type|string|이벤트 타입|
|23|promotion_unit|string|이벤트 타입에 따른 단위|
|24|promotion_value|int|이벤트 타입에 따른 값|
|25|store_item_id|string|인앱 결제용 마켓별 사용 상품 ID|
|26|paid_item_id|bigint|인앱 결제 가능한 상품 ID|
|27|cp_code|string|컨텐츠 제작 사 코드|
|28|sale_start_dt|timestamp|판매 시작일|
|29|started_dt|timestamp|컨텐츠 이용 시작일|
|30|ended_dt|timestamp|컨텐츠 이용 만료일|
|31|pay_system|string|결제 방식/옵션 {INAPP, JELLY, WEVERSE_SHOP, PG}|
|32|pay_method|string|결제 방식에 따른 결제 수단|
|33|sale_id|bigint|weverseshop sale_id|
|34|sale_currency_code|string|상품 객단가 결제 통화|
|35|sale_price|double|상품 객단가(meta)|
|36|is_fc|int|주문 당시 아티스트 멤버십 가입 여부|
|37|ord_item_qty|int|구매 상품 수|
|38|cx_item_qty|int|취소(환급) 상품 수|
|39|currency_code|string|유저가 지불한 금액의 통화|
|40|paid_amt|double|유저가 실제 지불한 금액|
|41|paid_amt_krw|double|유저가 실제 지불한 금액_원화환산|
|42|paid_amt_krw_inner|double|(젤리의 경우) 내부 단가로 계산된 결제 금액_원화환산|
|43|cx_amt|double|유저가 취소(환급)한 금액|
|44|cx_amt_krw|double|유저가 실제 취소한 금액_원화환산|
|45|cx_amt_krw_inner|double|(젤리의 경우) 내부 단가로 계산된 취소 금액_원화환산|
|46|seq_pay_completed|int|유저별 구입 한(지불 완료) 상품 순서, 위버스샵 결제분 제외|
|47|seq_all|int|유저별 상품 거래 내역의 전체 순서, 위버스샵 걸제분 제외|
|48|run_timestamp|timestamp|데이터가 write된 날짜, 시간|


---
# HOW TO USE

### Downstream Table/View
- `we_mart.wv_order` 테이블을 사용하여 `we_mart.stats_wv_d_svod_accum_users` 테이블을 생성하는 예시
    - ```sql
      select
      timestamp(current_timestamp() + interval '9' hour) as run_timestamp,
      key_date,
      a.we_art_id,
      c.we_art_name,
      nvl(product_name, 'TOTAL') as goods_name,
      nvl(dur_type, 'TOTAL') as dur_type,
      nvl(ctry_code, 'TOTAL') as ctry,
      nvl(b.ctry_name, 'TOTAL') as ctry_name,
      nvl(b.region_type, 'TOTAL') as region_type,
      count(distinct wv_user_id) as active_users
      from (
        select distinct date(pay_dt) as key_date, we_art_id, product_name, dur_type, ctry_code, wv_user_id
        from we_mart.wv_order
        where pay_method != 'WEPLY'
        and pay_system = 'INAPP'
        and product_type = 'SVOD'
      ) as a
      left join we_mart.view_we_country as b
      on a.ctry_code = b.ctry_code
      left join we_mart.we_artist as c
      on a.we_art_id = c.we_art_id
      group by grouping sets(
          (key_date, we_art_id, product_name, dur_type, ctry_code)
         ,(key_date, we_art_id, ctry_code)
         ,(key_date, we_art_id, product_name, dur_type)
         ,(key_date, we_art_id)
      )
      order by key_date, we_art_id, goods_name, dur_type, ctry
      ```
- `we_mart.wv_order` 테이블을 사용하여 `we_mart.stats_wv_d_user_purchase` 테이블을 생성하는 예시
    - ```sql
      select
      timestamp(current_timestamp() + interval '9' hour) as run_timestamp,
      key_date,
      a.we_art_id,
      c.we_art_name,
      nvl(product_type, 'TOTAL') as product_type,
      nvl(ctry_code, 'TOTAL') as ctry,
      nvl(b.ctry_name, 'TOTAL') as ctry_name,
      nvl(b.region_type, 'TOTAL') as region_type,
      count(distinct wv_user_id) as active_users
      from (
        select distinct date(pay_dt) as key_date, we_art_id, product_type, ctry_code, wv_user_id
        from we_mart.wv_order
        where pay_method != 'WEPLY'
        and pay_system = 'INAPP'
      ) as a
      left join we_mart.view_we_country as b
      on a.ctry_code = b.ctry_code
      left join we_mart.we_artist as c
      on a.we_art_id = c.we_art_id
      group by grouping sets(
          (key_date, we_art_id, product_type, ctry_code)
         ,(key_date, we_art_id, ctry_code)
         ,(key_date, we_art_id, product_type)
         ,(key_date, we_art_id)
      )
      order by key_date, we_art_id, product_type, ctry
      ```
- `we_mart.wv_order` 테이블을 사용하여 `we_mart.stats_wv_d_product_sale` 테이블을 생성하는 예시
    - ```sql
      select
      timestamp(current_timestamp() + interval '9' hour) as run_timestamp,
      key_date,
      a.we_art_id,
      c.we_art_name,
      product_id,
      product_name,
      product_type,
      nvl(ctry_code, 'TOTAL') as ctry,
      nvl(b.ctry_name, 'TOTAL') as ctry_name,
      nvl(b.region_type, 'TOTAL') as region_type,
      sum(ord_item_qty) as sale_qty,
      sum(paid_amt_krw) as sale_amt_krw
      from (
        select distinct date(pay_dt) as key_date, we_art_id, product_id, product_name, product_type, ctry_code
        from we_mart.wv_order
        where pay_method != 'WEPLY'
        and pay_system = 'INAPP'
      ) as a
      left join we_mart.view_we_country as b
      on a.ctry_code = b.ctry_code
      left join we_mart.we_artist as c
      on a.we_art_id = c.we_art_id
      group by grouping sets(
          (key_date, we_art_id, product_id, product_name, product_type, ctry_code)
         ,(key_date, we_art_id, product_id, product_name, product_type)
         ,(key_date, we_art_id, ctry_code)
         ,(key_date, we_art_id, product_id, product_name)
         ,(key_date, we_art_id)
      )
      order by key_date, we_art_id, product_id, product_type, ctry
      ```

### Data Extraction
- 특정 기간 동안 특정 아티스트의 특정 상품을 구매한 유저의 수를 추출하는 예시
    - ```sql
      select count(distinct wv_user_id)
      from we_mart.wv_order
      where pay_dt between '2024-01-01' and '2024-01-31'
      and we_art_id = 1234
      and product_name = 'ARTIST 상품'
      ```
- 특정 기간 동안 특정 국가의 유저가 구매한 젤리의 총량을 추출하는 예시
    - ```sql
      select sum(paid_amt)
      from we_mart.wv_order
      where pay_dt between '2024-01-01' and '2024-01-31'
      and ctry_code = 'KR'
      and currency_code = 'JELLY'
      ```
- 특정 기간 동안 특정 아티스트의 상품을 구매한 유저 중, Fan Club 회원인 유저의 수를 추출하는 예시 (Fan Club 정보는 `we_mart.ws_fc_user_history` 테이블에서 가져옴)
    - ```sql
      select count(distinct a.wv_user_id)
      from we_mart.wv_order as a
      inner join we_mart.ws_fc_user_history as b
      on a.we_member_id = b.we_member_id
      and a.we_art_id = b.we_art_id
      and a.pay_dt between b.create_dt and b.expire_dt
      where a.pay_dt between '2024-01-01' and '2024-01-31'
      and a.we_art_id = 1234
      ```
---
# PIPELINE INFO

## ⌛️ BATCH

### DAG: `analytics_we_mart_priority_daily`

### Update Interval: DAILY

### Update Type: OVERWRITE

## 📍 LINK URLs

### Github: [Source Code](https://github.com/benxcorp/databricks/blob/main/src/data_analytics/mart/we_mart/wv_order.py)

### Airflow: [DAG](https://github.com/benxcorp/dp-airflow/blob/main/dags/utils/dynamic_dag/wev/task_list/analytics_we_mart_priority_daily.py)


---
# DEPENDENCIES

## 👨‍👩‍👧‍👦 Up/Downstream Table List

|Upstream Tables|Downstream Tables|
| :--- | :--- |
|billing.in_app_purchase|we_mart.stats_we_m_order_first|
|billing.purchase|we_mart.stats_we_m_order_first_seq|
|jelly.ledger|we_mart.stats_we_w_jelly_order_detail|
|jelly.order_item|we_mart.stats_wv_d_media_sale|
|jelly.point|we_mart.stats_wv_d_media_sale_cp|
|jelly.transaction|we_mart.stats_wv_d_svod_accum_users|
|product.product_payment_option|we_mart.we_order|
|we_mart.we_artist|we_mart.wv_jelly_transaction|
|we_mart.we_jelly_charge|we_mart.wv_video_play|
|we_mart.we_user|we_mart.wv_vod_play|
|we_mart.ws_fc_user_history| |
|we_mart.wv_user_ctry_history| |
|we_mart_wv1.wv_order_with_sale_id| |
|we_meta.currency_rate| |
|we_meta.we_digital_product| |
|we_meta.we_media_product| |
|weverse2.community_member_purchase| |
|weverseshop.order_item| |
|weverseshop.order_sheet| |

## 🐤 Downstream Tables Info

### Downstream Tables
- **we_mart.we_order**: Weverse 플랫폼 통합 주문 현황
    - we_mart.wv_order 테이블과 we_mart.ws_order를 기반으로 weverseshop, phoning, weverse 3개 서비스 주문 데이터를 통합하여 제공
- **we_mart.wv_video_play**: 위버스 비디오 재생 클릭 데이터
    - Weverse 서버 로그 데이터를 기반으로 위버스 비디오 재생 클릭 로그를 제공, we_mart.wv_order를 참고 하여 유료 미디어의 구매 정보를 가져옴
- **we_mart.wv_vod_play**: 위버스 VOD, LIVE to VOD, Youtube 재생 서버로그 마트
    - Weverse 서버 로그 데이터를 기반으로 위버스 VOD, LIVE to VOD, Youtube 재생 서버로그 마트를 제공
- **we_mart.stats_wv_d_svod_accum_users**: 일간 SVOD 누적 유효 회원 수 현황
    - we_mart.wv_order 테이블을 기반으로 일간 SVOD 누적 유효 회원 수 현황을 제공

### Downstream View Tables
- **[해당 target table을 활용하는 View table은 없음]**

---
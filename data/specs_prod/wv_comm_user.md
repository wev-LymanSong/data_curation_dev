we_mart.wv_comm_user
====================

# BASIC INFO

|**About**| 담당자 수기 입력 필요 |
| :--- | :--- |
|**Database**|**we_mart**|
|**Table Type**|MART PRIMARY|
|**Partitioned by**|`part_comm_id`, `part_date`|
|**Created/ Last Updated At**|2021-11-29 / 2024-07-22|
|**Created By**|박상민|
|**Last Updated By**|윤상혁|
|**Collaborators**|윤상혁[26], 박상민[4], 송재영[1], 구민서[1], 이현지[1], 박상민[1]|

#### Change History
|**Date**|**By**|**LINK**|
| :--- | :--- | :--- |
|2021-11-29|박상민|[PR](https://github.com/benxcorp/databricks/commit/8dc809154614d40353684e2d2023adee4ec47cef)|
|2021-12-01|박상민|[PR](https://github.com/benxcorp/databricks/commit/cc3cd0becda316e17d965e85bf6078d2de2fd217)|
|2021-12-09|박상민|[PR](https://github.com/benxcorp/databricks/commit/e478ed7251f53863117a62580a9e9fc5c4694a5c)|
|2021-12-16|박상민|[PR](https://github.com/benxcorp/databricks/commit/0eda7844400d0d7ab9cb0347029458c261174d8f)|
|2022-04-28|박상민|[PR](https://github.com/benxcorp/databricks/commit/d7ef6f089505e1f5918001186b58b1d393a03d2d)|
|2022-06-21|이현지|[PR](https://github.com/benxcorp/databricks/commit/4de5d0a511e4aea4096e4e68957053d954f979fb)|
|2022-07-18|윤상혁|[PR](https://github.com/benxcorp/databricks/commit/f904a4924014252117ed33e97eb44565e25c7186)|
|2022-07-18|윤상혁|[PR](https://github.com/benxcorp/databricks/commit/51e647354a0ca91f0567a102beee8797aec7eb49)|
|2022-07-19|윤상혁|[PR](https://github.com/benxcorp/databricks/commit/d76256a496a40bb26428e0b172318e7fc2a090ff)|
|2022-07-19|윤상혁|[PR](https://github.com/benxcorp/databricks/commit/4424e92ab0877a1e6c56fb28464fe2de89ebfe31)|
|2022-07-20|윤상혁|[PR](https://github.com/benxcorp/databricks/commit/40e894d22d6fa8c7190a6f539aef69a89f7590c6)|
|2022-07-25|윤상혁|[PR](https://github.com/benxcorp/databricks/commit/74b40d6c2cf899abb4b76cc5de7e482e20264ae5)|
|2022-08-05|윤상혁|[PR](https://github.com/benxcorp/databricks/commit/58c64e69ea83eb3c585e8db66ef4ade46a29c40c)|
|2022-08-09|윤상혁|[PR](https://github.com/benxcorp/databricks/commit/f73a5e14d09ab45719699418dc8d77cd0189a995)|
|2022-08-12|윤상혁|[PR](https://github.com/benxcorp/databricks/commit/5cc3acc9f9284d510f0ce11970abe956b0bfb548)|
|2022-08-30|윤상혁|[PR](https://github.com/benxcorp/databricks/commit/b987b78d88d58887819fef19370408764e183ef1)|
|2022-08-30|윤상혁|[PR](https://github.com/benxcorp/databricks/commit/dec092e701cf45cc2ccdca418aa5999b12e01550)|
|2022-08-31|윤상혁|[PR](https://github.com/benxcorp/databricks/commit/f64511691950d282d3a5224d072ef9400ea7b47f)|
|2022-08-31|윤상혁|[PR](https://github.com/benxcorp/databricks/commit/501fec065832bac2c8495203afd6c6f552fbcc62)|
|2022-09-21|윤상혁|[PR](https://github.com/benxcorp/databricks/commit/e773e4e847a26521a3adfb8836a48f1a7300ab31)|
|2022-09-22|윤상혁|[PR](https://github.com/benxcorp/databricks/commit/f5ab46373c03662ad7ef6533bc6b39fbee9ced60)|
|2022-10-04|윤상혁|[PR](https://github.com/benxcorp/databricks/commit/a31e0649bb87b99eecefaa1967b43a3e68825b15)|
|2022-10-05|윤상혁|[PR](https://github.com/benxcorp/databricks/commit/a0bd7450977a7100cb954f70581fa55ff97b98b0)|
|2022-10-14|윤상혁|[PR](https://github.com/benxcorp/databricks/commit/c0f3d80ab02475bd28d2f87c43604934279294e1)|
|2022-12-02|윤상혁|[PR](https://github.com/benxcorp/databricks/commit/bf50526b544385ab544c6f14dc51111d1f1bea5d)|
|2022-12-09|구민서|[PR](https://github.com/benxcorp/databricks/commit/bd183779c84e616084e05627330a1c8b98ca44bd)|
|2023-03-10|윤상혁|[PR](https://github.com/benxcorp/databricks/commit/9df24d9741cea14704ae1965644c754ad98831d9)|
|2023-10-16|윤상혁|[PR](https://github.com/benxcorp/databricks/commit/6d3501e175a20e6423e7320054e6a58d3c0f0fdd)|
|2024-01-19|윤상혁|[PR](https://github.com/benxcorp/databricks/commit/e00fdff1f6ec822a540acebdffd7b4f8a386e67f)|
|2024-03-20|윤상혁|[PR](https://github.com/benxcorp/databricks/commit/3f08ce4d6aed1bca75a7df13a2bcce930c7e54eb)|
|2024-06-07|윤상혁|[PR](https://github.com/benxcorp/databricks/commit/9e6c37efe5459afb405531aa17364cddf27da233)|
|2024-06-24|윤상혁|[PR](https://github.com/benxcorp/databricks/commit/70b8472ec486d111ac44d49ae8faf57060f751a6)|
|2024-07-03|송재영|[PR](https://github.com/benxcorp/databricks/commit/69b36d8e869e328cb096dbcf7e8a90a9520fcbe3)|
|2024-07-22|윤상혁|[PR](https://github.com/benxcorp/databricks/commit/d983591076e2211d2592fc576f2893c13f8a7ffe)|


# TABLE NOTICE

### 테이블 개요

* **테이블 목적**: 위버스 커뮤니티 회원 정보 및 활동 이력을 담고 있는 테이블
* **데이터 레벨**: TRANSACTIONAL DATA
* **파티션 키**: `part_comm_id`, `part_date`
* **주요 키**: `comm_user_id`

### 테이블 특징
* 위버스 커뮤니티 회원의 다양한 정보를 담고 있음
* `comm_user_id`를 통해 회원 정보를 식별 가능
* `comm_id`를 통해 커뮤니티 정보를 식별 가능
* `wv_user_id`를 통해 위버스 플랫폼 회원 ID를 식별 가능
* `we_member_id`를 통해 위버스 플랫폼 회원 ID를 식별 가능
* `is_fc`, `fc_id`를 통해 팬클럽 가입 여부 및 팬클럽 ID 정보를 제공

### 데이터 추출 및 생성 과정

1. **주요 데이터 소스**:
    * `wev_prod.weverse2.community_log_member_status_log`: 커뮤니티 회원 상태 변경 이력
    * `wev_prod.weverse2.community_member_special_member`: 커뮤니티 스페셜 멤버 정보
    * `wev_prod.we_mart.we_user`: 위버스 플랫폼 회원 정보
    * `wev_prod.we_mart.ods_wv_member_profile`: 위버스 커뮤니티 회원 프로필 정보
    * `wev_prod.we_mart.ws_fc_user_history`: 팬클럽 가입 이력
    * `wev_prod.we_mart.we_artist`: 아티스트 정보
    * `wev_prod.we_mart.wv1_join_info`: 위버스 커뮤니티 회원 가입 정보(WV1)
    * `wev_prod.weverse2.notification_push_config`: 알림 설정 정보(WV2)
    * `wev_prod.we_mart.wv_user_ctry_history`: 회원 국가 변경 이력
2. **데이터 전처리**:
    * `community_log_member_status_log` 테이블에서 `type` 컬럼 값이 `subscribe` 또는 `unsubscribe` 인 데이터만 추출
    * `community_member_special_member` 테이블에서 `special_member_type` 컬럼 값이 `ARTIST` 또는 `OTHER_COMMUNITY_ARTIST` 인 데이터만 추출
    * `ods_wv_member_profile` 테이블에서 `part_date` 컬럼 값이 `bef_key` 와 `key` 사이의 데이터만 추출
    * `ws_fc_user_history` 테이블에서 `part_date` 컬럼 값이 `key` 이고, `ord_status` 컬럼 값이 `PAYMENT_FAILED`가 아닌 데이터만 추출
    * `we_user` 테이블에서 `part_date` 컬럼 값이 `key` 인 데이터만 추출
3. **데이터 통합**:
    * 위에서 추출한 데이터를 `join` 연산을 통해 통합
    * `wv_user_id` 컬럼을 기준으로 여러 테이블을 `left join`
4. **최종 테이블 생성**:
    * 통합된 데이터를 `we_mart.wv_comm_user` 테이블에 저장
    * `part_comm_id`와 `part_date` 컬럼을 파티션 키로 사용

### 테이블 활용 가이드

* **주요 활용**:
    * 위버스 커뮤니티 회원 정보 분석
    * 회원 활동 이력 분석
    * 팬클럽 가입 정보 분석
    * 아티스트 정보 분석
* **조인 시 유의사항**:
    * `wv_user_id` 컬럼을 사용하여 다른 테이블과 조인
    * `comm_id` 컬럼을 사용하여 다른 테이블과 조인
    * `we_member_id` 컬럼을 사용하여 다른 테이블과 조인
    * `part_date` 컬럼을 사용하여 다른 테이블과 조인
    * `comm_user_id` 컬럼을 사용하여 다른 테이블과 조인

### 추가 정보

* 해당 테이블은 위버스 커뮤니티 회원 정보 및 활동 이력을 담고 있는 TRANSACTIONAL DATA 테이블
* `part_comm_id` 와 `part_date` 컬럼을 파티션 키로 사용하여 데이터를 효율적으로 관리
* `comm_user_id` 컬럼을 통해 회원 정보를 식별 가능
* `comm_id` 컬럼을 통해 커뮤니티 정보를 식별 가능
* `wv_user_id` 컬럼을 통해 위버스 플랫폼 회원 ID를 식별 가능
* `we_member_id` 컬럼을 통해 위버스 플랫폼 회원 ID를 식별 가능
* `is_fc`, `fc_id` 컬럼을 통해 팬클럽 가입 여부 및 팬클럽 ID 정보를 제공
* `is_official` 컬럼을 통해 아티스트 공식 계정 여부를 확인 가능
* `wv_user_status` 컬럼을 통해 위버스 플랫폼 회원 상태를 확인 가능
* `comm_user_status` 컬럼을 통해 커뮤니티 회원 상태를 확인 가능
* `comm_user_grade` 컬럼을 통해 커뮤니티 회원 등급을 확인 가능
* `ip_ctry` 컬럼을 통해 회원의 최근 접속 국가를 확인 가능
* `comm_user_first_dt` 컬럼을 통해 커뮤니티 최초 가입 일시를 확인 가능
* `tot_comm_user_first_dt` 컬럼을 통해 커뮤니티 첫 가입 일자를 확인 가능
* `is_first_user_comm` 컬럼을 통해 커뮤니티 첫 가입 여부를 확인 가능
* `comm_user_cre_dt` 컬럼을 통해 커뮤니티 회원 생성 일시를 확인 가능
* `comm_user_end_dt` 컬럼을 통해 커뮤니티 회원 종료 일시를 확인 가능
* `is_profile_created` 컬럼을 통해 프로필 생성 여부를 확인 가능
* `is_profile_private` 컬럼을 통해 프로필 비공개 여부를 확인 가능
* `is_upload_profile_img` 컬럼을 통해 프로필 이미지 업로드 여부를 확인 가능
* `is_upload_profile_background_img` 컬럼을 통해 프로필 배경 이미지 업로드 여부를 확인 가능
* `notification_type`, `like_on_comment_alarm`, `hot_post_alarm` 등의 컬럼을 통해 알림 설정 정보를 확인 가능
* `v_ch_join_dt` 컬럼을 통해 V채널 가입 시점을 확인 가능
* `is_v_user` 컬럼을 통해 V이관 여부를 확인 가능
---
# COLUMN INFO

|#|Column Name|Data Type|Comment|
| :--- | :--- | :--- | :--- |
|0|key_date|date|key_date|
|1|wv_user_id|bigint|wv_user_id|
|2|we_member_id|bigint|we_member_id|
|3|comm_id|bigint|community_id|
|4|we_art_id|int|we 아티스트 id|
|5|we_art_name|string|we 아티스트 name|
|6|is_fc|int|멤버쉽 여부|
|7|fc_id|bigint|멤버쉽 id|
|8|art_indi_id|string|아티스트 멤버 id|
|9|art_indi_type|string|아티스트 타입|
|10|art_indi_name|string|아티스트 멤버 명|
|11|ip_ctry|string|사용자 최근 접속 국가|
|12|wv_user_status|string|위버싀 회원 상태|
|13|comm_user_first_dt|timestamp|커뮤니티 최초 가입 일시|
|14|tot_comm_user_first_dt|timestamp|커뮤니티 첫 가입일자|
|15|is_first_user_comm|int|커뮤니티 첫 가입여부|
|16|comm_user_status|string|커뮤니티 회원 상태|
|17|comm_user_grade|string|커뮤니티 회원 구분|
|18|comm_user_cre_dt|timestamp|현재 커뮤니티 회원 생성 일시|
|19|comm_user_end_dt|timestamp|현재 커뮤니티 회원 종료 일시|
|20|is_profile_created|bigint|프로필 생성여부|
|21|profile_name|string|프로필 닉네임|
|22|is_profile_private|bigint|프로필 비공개여부|
|23|is_upload_profile_img|int|프로필 이미지 업로드 여부|
|24|is_upload_profile_background_img|int|프로필 백그라운드 이미지 업로드 여부|
|25|is_official|bigint|공식 계정여부|
|26|comm_user_id|string|comm_user_id|
|27|cnt_comm_user_id|bigint|가입 comm_user_id 수|
|28|sum_report_count|bigint|신고 여부|
|29|comm_user_seq|int|커뮤니티 회원 시퀀스|
|30|notification_type|string|알림 수신 설정 타입 (WV1)|
|31|like_on_comment_alarm|tinyint|내 댓글에 느낌이 달렸을 때 알람 (WV1)|
|32|hot_post_alarm|tinyint|내 글이 핫포스트에 노출시 알람|
|33|new_fc_alarm|tinyint|새로운 fc only 알람 (WV1)|
|34|new_media_alarm|tinyint|새로운 미디어 알람 (WV1)|
|35|new_community_notice_alarm|tinyint|커뮤니티 공지 알람 (WV1)|
|36|artist_to_fans_post_alarm|tinyint|아티스트 새로운 투팬즈 포스트 알람 (WV1)|
|37|artist_post_alarm|tinyint|아티스트 새로운 포스트 알람 (WV1)|
|38|artist_like_on_my_post_alarm|tinyint|내가 작성한 포스트 > 아티스트 느낌 알람 (WV1)|
|39|artist_comment_on_my_post_alarm|tinyint|내가 작성한 포스트 > 아티스트 댓글 알람 (WV1)|
|40|like_on_my_post_alarm|tinyint|내가 작성한 포스트 > 느낌 알람 (WV1)|
|41|comment_on_my_post_alarm|tinyint|내가 작성한 포스트 > 댓글 알람 (WV1)|
|42|after_receiving_artist_comment_alarm|tinyint|아티스트 댓글 받은 이후 알림 받기 (WV1)|
|43|artist_cheering_me_push_enabled|tinyint|아티스트 활동 알림 > 나를 응원하기 알림 (WV2)|
|44|artist_comment_push_enabled|tinyint|아티스트 활동 알림 > 나를 댓글 알림 (WV2)|
|45|artist_live_on_air_push_enabled|tinyint|아티스트 활동 알림 > 라이브 시작 (WV2)|
|46|artist_live_reservation_push_enabled|tinyint|아티스트 활동 알림 > 라이브 예약 (WV2)|
|47|artist_moment_push_enabled|tinyint|아티스트 활동 알림 > 모먼트 작성 (WV2)|
|48|artist_post_push_enabled|tinyint|아티스트 활동 알림 > 포스트 작성 (WV2)|
|49|comment_push_enabled|tinyint|내 활동 > 댓글 알림 (WV2)|
|50|community_anniversary_push_enabled|tinyint|커뮤니티 알림 > 기념일 알림 (WV2)|
|51|community_media_push_enabled|tinyint|아티스트 알림 > 미디어 등록 (WV2)|
|52|community_notice_push_enabled|tinyint|커뮤니티 알림 > 공지사항 등록 (WV2)|
|53|following_push_enabled|tinyint|내 활동 알림 > 나를 팔로우 (WV2)|
|54|v_ch_join_dt|timestamp|V채널 가입 시점|
|55|is_v_user|int|V이관 유무|
|56|part_comm_id|bigint|partition_community_id|
|57|part_date|string|partition_date|
|58|run_timestamp|timestamp|run_timestamp|


---
# HOW TO USE

`
### Downstream Table/View
- 커뮤니티 가입 유저수를 기준일자, 아티스트 ID, 국가별로 집계한 테이블을 생성
    - ```sql
      select
        part_date,
        we_art_id,
        ip_ctry,
        count(distinct we_member_id) as cnt_user
      from wev_prod.we_mart.wv_comm_user
      where comm_user_status = 'NORMAL'
        and wv_user_status = 'NORMAL'
      group by 1, 2, 3
      ```
- 커뮤니티 가입 유저수를 기준일자, 아티스트 ID, 국가별로 집계한 테이블을 생성 (파티션 키 활용)
    - ```sql
      create or replace table wev_prod.we_mart.stats_wv_comm_user_cnt
      (
        part_date date comment '기준일자',
        we_art_id int comment '아티스트 ID',
        ip_ctry string comment '국가 코드',
        cnt_user bigint comment '가입 유저수'
      )
      using delta
      partitioned by (part_date, we_art_id, ip_ctry)
      comment '커뮤니티 가입 유저수 통계'
      as
      select
        part_date,
        we_art_id,
        ip_ctry,
        count(distinct we_member_id) as cnt_user
      from wev_prod.we_mart.wv_comm_user
      where comm_user_status = 'NORMAL'
        and wv_user_status = 'NORMAL'
      group by 1, 2, 3
      ```
- 커뮤니티 가입 유저 정보를 기준일자, 아티스트 ID, 국가별로 집계한 테이블을 생성 (파티션 키 활용)
    - ```sql
      create or replace table wev_prod.we_mart.stats_wv_comm_user_info
      (
        part_date date comment '기준일자',
        we_art_id int comment '아티스트 ID',
        ip_ctry string comment '국가 코드',
        cnt_user bigint comment '가입 유저수',
        avg_comm_user_cre_dt timestamp comment '가입 유저 평균 생성 시간',
        avg_comm_user_end_dt timestamp comment '가입 유저 평균 종료 시간'
      )
      using delta
      partitioned by (part_date, we_art_id, ip_ctry)
      comment '커뮤니티 가입 유저 정보 통계'
      as
      select
        part_date,
        we_art_id,
        ip_ctry,
        count(distinct we_member_id) as cnt_user,
        avg(comm_user_cre_dt) as avg_comm_user_cre_dt,
        avg(comm_user_end_dt) as avg_comm_user_end_dt
      from wev_prod.we_mart.wv_comm_user
      where comm_user_status = 'NORMAL'
        and wv_user_status = 'NORMAL'
      group by 1, 2, 3
      ```
- 커뮤니티 가입 유저 정보를 기준일자, 아티스트 ID, 국가별로 집계한 테이블을 생성 (파티션 키 활용, we_user 테이블과 조인)
    - ```sql
      create or replace table wev_prod.we_mart.stats_wv_comm_user_detail
      (
        part_date date comment '기준일자',
        we_art_id int comment '아티스트 ID',
        ip_ctry string comment '국가 코드',
        cnt_user bigint comment '가입 유저수',
        avg_comm_user_cre_dt timestamp comment '가입 유저 평균 생성 시간',
        avg_comm_user_end_dt timestamp comment '가입 유저 평균 종료 시간',
        avg_wv_last_access_dt timestamp comment '가입 유저 평균 마지막 접속 시간'
      )
      using delta
      partitioned by (part_date, we_art_id, ip_ctry)
      comment '커뮤니티 가입 유저 상세 정보 통계'
      as
      select
        a.part_date,
        a.we_art_id,
        a.ip_ctry,
        count(distinct a.we_member_id) as cnt_user,
        avg(a.comm_user_cre_dt) as avg_comm_user_cre_dt,
        avg(a.comm_user_end_dt) as avg_comm_user_end_dt,
        avg(b.wv_last_access_dt) as avg_wv_last_access_dt
      from wev_prod.we_mart.wv_comm_user a
      left join wev_prod.we_mart.we_user b on a.we_member_id = b.we_member_id and a.part_date = b.part_date
      where a.comm_user_status = 'NORMAL'
        and a.wv_user_status = 'NORMAL'
      group by 1, 2, 3
      ```

### Data Extraction
- 특정 아티스트의 커뮤니티에 가입한 유저 중, 최근 3개월 이내에 마지막 접속한 유저 목록을 추출
    - ```sql
      select
        we_member_id,
        wv_user_id,
        comm_user_status,
        wv_user_status,
        wv_last_access_dt
      from wev_prod.we_mart.wv_comm_user
      inner join wev_prod.we_mart.we_user on wv_comm_user.we_member_id = we_user.we_member_id and wv_comm_user.part_date = we_user.part_date
      where we_art_id = ARTIST
        and part_date = '2024-01-01'
        and date(wv_last_access_dt) >= '2023-10-01'
      ```
- 특정 기간 동안, 특정 국가의 유저가 가입한 커뮤니티 목록을 추출
    - ```sql
      select
        we_art_id,
        we_art_name,
        comm_id,
        comm_user_first_dt
      from wev_prod.we_mart.wv_comm_user
      where part_date >= '2023-10-01'
        and part_date <= '2023-12-31'
        and ip_ctry = 'KR'
      ```
- 특정 아티스트의 커뮤니티에 가입한 유저 중, 멤버십 가입 여부, 프로필 생성 여부, 프로필 공개 여부, 알림 설정 정보를 추출
    - ```sql
      select
        we_member_id,
        wv_user_id,
        is_fc,
        is_profile_created,
        is_profile_private,
        like_on_comment_alarm,
        hot_post_alarm,
        new_fc_alarm,
        new_media_alarm,
        new_community_notice_alarm,
        artist_to_fans_post_alarm,
        artist_post_alarm,
        artist_like_on_my_post_alarm,
        artist_comment_on_my_post_alarm,
        like_on_my_post_alarm,
        comment_on_my_post_alarm,
        after_receiving_artist_comment_alarm
      from wev_prod.we_mart.wv_comm_user
      where we_art_id = ARTIST
        and part_date = '2024-01-01'
      ```
- 특정 기간 동안, 커뮤니티 가입 유저 중, 멤버십 가입 유저 비율, 프로필 생성 유저 비율, 프로필 공개 유저 비율을 계산
    - ```sql
      select
        part_date,
        count(distinct we_member_id) as total_user,
        count(distinct case when is_fc = 1 then we_member_id end) as fc_user,
        count(distinct case when is_profile_created = 1 then we_member_id end) as profile_created_user,
        count(distinct case when is_profile_private = 1 then we_member_id end) as profile_private_user
      from wev_prod.we_mart.wv_comm_user
      where part_date >= '2023-10-01'
        and part_date <= '2023-12-31'
      group by 1
      ```
- 특정 아티스트의 커뮤니티에 가입한 유저 중, 멤버십 가입 유저와 일반 유저의 가입 날짜 분포를 비교
    - ```sql
      select
        part_date,
        'FC' as user_type,
        count(distinct we_member_id) as user_cnt
      from wev_prod.we_mart.wv_comm_user
      where we_art_id = ARTIST
        and part_date >= '2023-10-01'
        and part_date <= '2023-12-31'
        and is_fc = 1
      group by 1
      union all
      select
        part_date,
        'GENERAL' as user_type,
        count(distinct we_member_id) as user_cnt
      from wev_prod.we_mart.wv_comm_user
      where we_art_id = ARTIST
        and part_date >= '2023-10-01'
        and part_date <= '2023-12-31'
        and is_fc = 0
      group by 1
      ```
- 특정 아티스트의 커뮤니티에 가입한 유저 중, 알림 설정별 가입 유저수를 집계
    - ```sql
      select
        part_date,
        'LIKE_ON_COMMENT_ALARM' as alarm_type,
        count(distinct case when like_on_comment_alarm = 1 then we_member_id end) as user_cnt
      from wev_prod.we_mart.wv_comm_user
      where we_art_id = ARTIST
        and part_date >= '2023-10-01'
        and part_date <= '2023-12-31'
      group by 1
      union all
      select
        part_date,
        'HOT_POST_ALARM' as alarm_type,
        count(distinct case when hot_post_alarm = 1 then we_member_id end) as user_cnt
      from wev_prod.we_mart.wv_comm_user
      where we_art_id = ARTIST
        and part_date >= '2023-10-01'
        and part_date <= '2023-12-31'
      group by 1
      -- 다른 알림 유형에 대한 쿼리 추가
      ```
---
# PIPELINE INFO

## ⌛️ BATCH

### DAG: `analytics_we_mart_priority_daily`

### Update Interval: DAILY

### Update Type: OVERWRITE

## 📍 LINK URLs

### Github: [Source Code](https://github.com/benxcorp/databricks/blob/main/src/data_analytics/mart/we_mart/wv_comm_user.py)

### Airflow: [DAG](https://github.com/benxcorp/dp-airflow/blob/main/dags/utils/dynamic_dag/wev/task_list/analytics_we_mart_priority_daily.py)


---
# DEPENDENCIES

## 👨‍👩‍👧‍👦 Up/Downstream Table List

|Upstream Tables|Downstream Tables|
| :--- | :--- |
|we_mart.ods_wv_member_profile|we_mart.stats_wv_d_comm_cross_join|
|we_mart.we_artist|we_mart.stats_wv_d_comm_cross_join_agg|
|we_mart.we_user|we_mart.stats_wv_d_comm_engage_usr|
|we_mart.ws_fc_user_history|we_mart.stats_wv_d_comm_join|
|we_mart.wv1_join_info|we_mart.stats_wv_d_live_agg|
|we_mart.wv_user_ctry_history|we_mart.stats_wv_d_pop_post|
|we_meta.v_to_wv_comm_mapping|we_mart.stats_wv_d_user_setting|
|weverse2.community_common_report|we_mart.stats_wv_m_comm_engage_usr|
|weverse2.community_log_member_status_log|we_mart.stats_wv_m_pop_post|
|weverse2.community_log_v_member_migration|we_mart.stats_wv_w_comm_engage_usr|
|weverse2.community_member_special_member|we_mart.stats_wv_w_pop_post|
|weverse2.notification_push_config|we_mart.we_sale|
| |we_mart.we_user_dic_engaged_by_project|
| |we_mart.wv_comm_user_update|
| |we_mart.wv_dm_msg_fan|
| |we_mart.wv_dm_subscr_daily|
| |we_mart.wv_dm_subscr_history|
| |we_mart.wv_post_view|
| |we_mart.wv_sess_daily|

## 🐤 Downstream Tables Info

### Downstream Tables
- **wv_comm_user_update** : 커뮤니티 회원의 최신 상태 정보를 담고 있는 테이블. `wv_comm_user` 테이블을 기반으로 매일 생성되며, 회원의 가입, 탈퇴, 상태 변경 이력을 추적.
    - `wv_comm_user` 테이블을 사용하여 회원의 최신 상태 정보를 추출.
    - 회원의 가입, 탈퇴, 상태 변경 이력을 파악하기 위해 `update_type` 컬럼을 사용.
    - `update_part_date` 컬럼은 상태값이 마지막으로 업데이트된 파티션 날짜를 나타냄.
    - 예시: 특정 날짜에 특정 커뮤니티에 가입한 회원 정보를 추출하려면 `wv_comm_user_update` 테이블에서 `comm_id`, `wv_user_id` 컬럼을 사용하고 `update_type` 컬럼이 `'c'`인 데이터만 필터링.
- **stats_wv_d_comm_engage_usr** : 커뮤니티 적극 활동 유저 통계를 일별로 집계하는 테이블. `wv_comm_user` 테이블을 사용하여 유저의 국가 정보를 추출.
    - `wv_post_view`, `wv_post_reaction`, `wv_media_reaction` 테이블과 함께 활동 유저 수를 계산.
    - `wv_comm_user` 테이블에서 `we_member_id`, `we_art_id` 컬럼을 사용하여 유저의 커뮤니티 가입 정보를 추출.
    - 예시: 특정 날짜의 커뮤니티 적극 활동 유저 수를 국가별로 집계하려면 `key_date`, `ctry_code` 컬럼을 사용.
- **stats_wv_w_comm_engage_usr** : 커뮤니티 적극 활동 유저 통계를 주별로 집계하는 테이블. `wv_comm_user` 테이블을 사용하여 유저의 국가 정보를 추출.
    - `wv_post_view`, `wv_post_reaction`, `wv_media_reaction` 테이블과 함께 활동 유저 수를 계산.
    - `wv_comm_user` 테이블에서 `we_member_id`, `we_art_id` 컬럼을 사용하여 유저의 커뮤니티 가입 정보를 추출.
    - 예시: 특정 주의 커뮤니티 적극 활동 유저 수를 국가별로 집계하려면 `key_date`, `ctry_code` 컬럼을 사용.
- **stats_wv_m_comm_engage_usr** : 커뮤니티 적극 활동 유저 통계를 월별로 집계하는 테이블. `wv_comm_user` 테이블을 사용하여 유저의 국가 정보를 추출.
    - `wv_post_view`, `wv_post_reaction`, `wv_media_reaction` 테이블과 함께 활동 유저 수를 계산.
    - `wv_comm_user` 테이블에서 `we_member_id`, `we_art_id` 컬럼을 사용하여 유저의 커뮤니티 가입 정보를 추출.
    - 예시: 특정 월의 커뮤니티 적극 활동 유저 수를 국가별로 집계하려면 `key_date`, `ctry_code` 컬럼을 사용.
- **wv_dm_subscr** : WDM 구독 현황을 담고 있는 테이블. `wv_comm_user` 테이블을 사용하여 유저의 커뮤니티 회원 여부를 판단.
    - `weverse2.community_member_purchase`, `we_mart.wv_jelly_order`, `weverse2.wdm_common_dm`, `weverse2.wdm_subscription`, `we_meta.we_digital_product`, `ws_fc_user_history` 테이블과 함께 구독 정보를 추출.
    - `wv_comm_user` 테이블에서 `wv_user_id`, `comm_id` 컬럼을 사용하여 유저의 커뮤니티 회원 여부를 판단.
    - 예시: 특정 날짜에 WDM 구독을 시작한 유저 중 커뮤니티 회원인 유저를 추출하려면 `start_dt` 컬럼을 사용하고 `is_comm_user` 컬럼이 `1`인 데이터만 필터링.

### Downstream View Tables
- **[없음]**
---
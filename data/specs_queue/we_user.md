
we_mart.we_user
===============

# BASIC INFO

|**About**| 담당자 수기 입력 필요 |
| :--- | :--- |
|**Database**|**we_mart**|
|**Table Type**|MART PRIMARY|
|**Partitioned by**|`part_date`|
|**Created/ Last Updated At**|2021-11-29 / 2024-07-16|
|**Created By**|박상민|
|**Last Updated By**|송재영|
|**Collaborators**|사공재현[21], 송재영[13], 이현지[1], 구민서[1], 박상민[1]|
  
#### Change History
|**Date**|**By**|**LINK**|
| :--- | :--- | :--- |
|2021-11-29|박상민|[PR](https://github.com/benxcorp/databricks/commit/8dc809154614d40353684e2d2023adee4ec47cef)|
|2022-01-18|송재영|[PR](https://github.com/benxcorp/databricks/commit/ecf2b9c150b165d72df05ae543dea8eb76c3cf77)|
|2022-01-18|송재영|[PR](https://github.com/benxcorp/databricks/commit/eeea7079a03d8458c2d468357d0ed2b0bded6168)|
|2022-01-20|송재영|[PR](https://github.com/benxcorp/databricks/commit/97a3103229a6875cb1b872e934314b2eff4c3b8b)|
|2022-02-22|송재영|[PR](https://github.com/benxcorp/databricks/commit/559996e34e9b8f6d9c23d4b82e4adca2b5bda63f)|
|2022-02-22|송재영|[PR](https://github.com/benxcorp/databricks/commit/ba94a76fc256ac47ad31c28166cefce67a8548c4)|
|2022-02-24|송재영|[PR](https://github.com/benxcorp/databricks/commit/58becf9440cb1bc5694af9f1a119ecc44d6492b7)|
|2022-02-28|송재영|[PR](https://github.com/benxcorp/databricks/commit/2bb81fbf4f16f10a0dc7ddb0b39707c58866877d)|
|2022-03-14|송재영|[PR](https://github.com/benxcorp/databricks/commit/c2e1c0ff076345261f3b8c7e38004a39777541f8)|
|2022-07-18|사공재현|[PR](https://github.com/benxcorp/databricks/commit/b634d7a5e05a775985924b7773428b2082831c51)|
|2022-07-19|사공재현|[PR](https://github.com/benxcorp/databricks/commit/f99be89c0e4c9a99cf79ac4d7bd041acf1a980fa)|
|2022-07-19|사공재현|[PR](https://github.com/benxcorp/databricks/commit/791126a31a6fbec2f582a98a33c6affb671d87cf)|
|2022-07-21|사공재현|[PR](https://github.com/benxcorp/databricks/commit/e0f5c1112d5d590026b71e6523d48bff28744b70)|
|2022-08-11|사공재현|[PR](https://github.com/benxcorp/databricks/commit/0b4746b80c7a0ec66e176e79685f33baf4e36061)|
|2022-08-23|사공재현|[PR](https://github.com/benxcorp/databricks/commit/d772b6b1f8711d939e02f83d08aed3626ac098bc)|
|2022-09-06|사공재현|[PR](https://github.com/benxcorp/databricks/commit/333b22416ac92781193d31c61ef14844362fb2d3)|
|2022-09-15|사공재현|[PR](https://github.com/benxcorp/databricks/commit/e93df4e8cb5daa59289c023e6c231d32fc5ff290)|
|2022-09-20|사공재현|[PR](https://github.com/benxcorp/databricks/commit/35fe42d47da0c817bcad4bca697ef7a35dba16f9)|
|2022-09-21|사공재현|[PR](https://github.com/benxcorp/databricks/commit/f33882c5ce97592808de9ac9f1755005739069d0)|
|2022-09-27|사공재현|[PR](https://github.com/benxcorp/databricks/commit/a71d5f180800b758994b59e0faa028afea1435eb)|
|2022-10-24|사공재현|[PR](https://github.com/benxcorp/databricks/commit/913b8f055b18b3ee7991d81c1375386ada20f40b)|
|2022-11-16|사공재현|[PR](https://github.com/benxcorp/databricks/commit/dd1bf2135d63f2d82608263cb0c60703877d4b62)|
|2022-11-17|사공재현|[PR](https://github.com/benxcorp/databricks/commit/f9dec2d11a3761b9377b4566db30d9ed768333db)|
|2022-11-18|사공재현|[PR](https://github.com/benxcorp/databricks/commit/83996b0cf797d1d16dac77a827c60c57a694fbf6)|
|2022-11-18|사공재현|[PR](https://github.com/benxcorp/databricks/commit/bb9278f63b5a24a94860ff8b148a07963a5f08a9)|
|2022-12-09|구민서|[PR](https://github.com/benxcorp/databricks/commit/bd183779c84e616084e05627330a1c8b98ca44bd)|
|2022-12-23|사공재현|[PR](https://github.com/benxcorp/databricks/commit/f143a8a6f7d3155793cbdc32788bb193f85ea048)|
|2022-12-29|송재영|[PR](https://github.com/benxcorp/databricks/commit/8340ec4cc5ff560d743d019c203e642ffb0858ec)|
|2023-01-02|사공재현|[PR](https://github.com/benxcorp/databricks/commit/66d6929778198f80561fb6df9f7998138dca08b5)|
|2023-03-06|사공재현|[PR](https://github.com/benxcorp/databricks/commit/94bd4fa7b4c58a40a465df69dca5379907476b3f)|
|2023-03-07|이현지|[PR](https://github.com/benxcorp/databricks/commit/c0e4264c0e45b14afe4c3bc727dac0641370e680)|
|2023-03-10|사공재현|[PR](https://github.com/benxcorp/databricks/commit/310e6192ceda060de1e105e25ff2e3734083d7c4)|
|2024-01-25|사공재현|[PR](https://github.com/benxcorp/databricks/commit/adcb511740e9d6a5183b2ee9c1db6f94fbe29bf5)|
|2024-06-07|송재영|[PR](https://github.com/benxcorp/databricks/commit/6a312dfa6be2c7c79a89aa618e98ac232fed4780)|
|2024-06-10|송재영|[PR](https://github.com/benxcorp/databricks/commit/9be905e840271c7690cde353aa632edbcf5e3680)|
|2024-07-01|송재영|[PR](https://github.com/benxcorp/databricks/commit/5234d09bd6e61dd5b298399cd1801bf3b079628e)|
|2024-07-16|송재영|[PR](https://github.com/benxcorp/databricks/commit/ad48a7226898b8a4f19c00f773f9e9bf3ab1a90d)|
  
  
# TABLE NOTICE
  
### 테이블 개요

* **테이블 목적**: 위버스 플랫폼의 모든 유저 정보를 통합하여 제공하며, 위버스, 위버스샵, 위버스앨범, 포닝, VLIVE 등의 서비스별 유저 정보를 맵핑하여 각 서비스 간의 유저 연관성을 파악할 수 있도록 한다.
* **데이터 레벨**: TRANSACTIONAL DATA
* **파티션 키**: `part_date`
* **주요 키**: `we_member_id`

### 테이블 특징

* 위버스 플랫폼의 모든 유저 정보를 `we_member_id`를 기준으로 통합
* 각 서비스 별 유저 ID와 서비스 별 가입/탈퇴 정보 제공
* 각 서비스의 최초 가입 및 가입 완료 시간, 마지막 접속 시간, 탈퇴 시간 등의 정보 제공
* `wv_trans_seq`, `ws_trans_seq` 컬럼을 통해 재가입 횟수 정보 제공
* `wv_service_user_key`, `ws_service_user_key` 컬럼을 통해 위버스와 위버스샵 간 유저 통합 정보 제공
* VLIVE 연동 정보 제공

### 데이터 추출 및 생성 과정

1. **주요 데이터 소스**:
    * `we_mart.ods_wemember_user`: 위멤버 유저 정보
    * `we_mart.ods_wv_user`: 위버스 유저 정보
    * `we_mart.ods_ws_user`: 위버스샵 유저 정보
    * `we_mart.ods_wv_notification_device`: 위버스 알림 설정 정보
    * `we_mart.ods_wv_user_last_accessed_at`: 위버스 마지막 접속 정보
    * `album.user`: 위버스앨범 유저 정보
    * `we_mart.ods_ph_fan_user`: 포닝 유저 정보
    * `weverse2.community_common_v_member_migration`: VLIVE 연동 정보
2. **데이터 전처리**:
    * `first_country_ip` 뷰 테이블 생성: 위버스와 위버스샵의 유저 정보를 `we_member_id` 기준으로 조인하여 최초 가입 국가 및 IP 정보 추출
    * `we_user_mapping_table` 뷰 테이블 생성: 위버스와 위버스샵의 유저 정보를 `we_member_id` 기준으로 조인하여 각 서비스 별 유저 정보 매핑
    * `wv_user_set` 뷰 테이블 생성: 위버스 알림 설정 정보에서 유저 ID와 언어 정보 추출
    * `wv_user_leave` 뷰 테이블 생성: 위버스 유저 정보에서 탈퇴 및 삭제된 유저 정보 추출
    * `ph_user` 뷰 테이블 생성: 포닝 유저 정보에서 최초 가입 시간 정보 추출
    * `vlive_link` 뷰 테이블 생성: VLIVE 연동 정보에서 유저 ID와 연동 시간 정보 추출
3. **데이터 통합**:
    * `we_user_mapping_table` 뷰 테이블을 기반으로 각 서비스 별 유저 정보를 통합
    * 각 서비스 별 뷰 테이블과 조인하여 각 서비스별 유저 정보를 추가
4. **최종 테이블 생성**:
    * `fin_df` 변수에 최종 테이블 데이터 프레임 생성
    * `we_mart.we_user` 테이블에 `fin_df` 데이터 프레임 저장

### 테이블 활용 가이드

* **주요 활용**:
    * 위버스 플랫폼의 유저 행동 분석
    * 서비스별 유저 정보 비교 분석
    * 각 서비스 간 유저 연관성 분석
    * 유저 세그먼테이션 및 타겟팅
* **조인 시 유의사항**:
    * `we_member_id`를 기준으로 다른 테이블과 조인하여 사용
    * `part_date`를 활용하여 동일한 날짜의 데이터를 조인
    * 각 서비스 별 유저 정보를 정확하게 매핑하기 위해 `wv_user_id`, `ws_user_id` 등의 컬럼을 활용

### 추가 정보

* `wv_trans_seq`와 `ws_trans_seq` 컬럼은 각 서비스 별 유저의 재가입 횟수를 나타내며, 첫 가입 시 1부터 시작한다.
* `wv_service_user_key`와 `ws_service_user_key` 컬럼은 위버스와 위버스샵 간 유저 통합 정보를 나타내며, 2024년 7월 2일부터 이 컬럼을 통해 두 서비스 간 유저를 매핑한다.
* `vlive_id`와 `vlive_linked_at` 컬럼은 VLIVE 연동 정보를 나타내며, VLIVE 계정과 위버스 계정 간의 연동 시간을 확인할 수 있다.
* `run_timestamp` 컬럼은 데이터가 생성된 시간을 나타낸다.  
---
# COLUMN INFO

|#|Column Name|Data Type|Comment|
| :--- | :--- | :--- | :--- |
|0|we_member_id|bigint|통합 계정인 wemember의 ID, 주요 키|
|1|we_cre_at|timestamp|위멤버 계정이 처음 만들어진 시점|
|2|we_leave_dt|timestamp|위멤버 계정 탈퇴 및 삭제 시점|
|3|ctry_code|string|유저의 처음 가입 시점 국가 정보|
|4|ip|string|유저의 처음 가입 시점 ip|
|5|join_service|string|해당 유저가 가입한 서비스 종류, 위버스/샵만 가입이면 wv/ws, 둘 모두 가입이면 we|
|6|wv_user_id|bigint|위버스 user_id|
|7|wv_lang|string|위버스 가입 시 설정한 언어 정보|
|8|wv_status|string|위버스 계정 상태|
|9|wv_cre_dt|timestamp|위버스 계정 가입 시점|
|10|wv_first_cre_dt|timestamp|위버스 계정이 가장 먼저 만들어진 시점(재가입 불문, 2021-11-24일 부터 카운팅)|
|11|wv_join_dt|timestamp|위버스 계정 가입 완료 시점|
|12|wv_first_join_dt|timestamp|위버스 계정이 가장 먼저 가입 완료된 시점(재가입 불문, 2021-11-24일 부터 카운팅)|
|13|wv_upd_dt|timestamp|위버스 계정 상태 업데이트 시점|
|14|wv_deactivated_dt|timestamp|위버스 계정 비활성화 시점, 활성화일 경우 null|
|15|wv_last_access_dt|timestamp|위버스 계정 별 마지막 접속 시점|
|16|wv_leave_dt|timestamp|위버스 계정 회원 탈퇴 시점|
|17|wv_trans_seq|int|위버스 계정의 재가입 횟수, 2021-11-24일 부터 카운팅하며 첫 가입이면 1|
|18|ws_user_id|bigint|위버스샵 user_id|
|19|ws_lang|string|위버스샵 가입 시 설정한 언어 정보|
|20|ws_status|string|위버스샵 계정 상태|
|21|ws_cre_dt|timestamp|위버스샵 계정 가입 시점|
|22|ws_first_cre_dt|timestamp|위버스샵 계정이 가장 먼저 만들어진 시점(재가입 불문, 2021-11-24일 부터 카운팅)|
|23|ws_join_dt|timestamp|위버스샵 계정 가입 완료 시점|
|24|ws_first_join_dt|timestamp|위버스샵 계정이 가장 먼저 가입 완료된 시점(재가입 불문, 2021-11-24일 부터 카운팅)|
|25|ws_upd_dt|timestamp|위버스샵 계정 상태 업데이트 시점|
|26|ws_deactivated_dt|timestamp|위버스샵 계정 비활성화 시점, 활성화일 경우 null|
|27|ws_last_access_dt|timestamp|위버스샵 계정 별 마지막 접속 시점|
|28|ws_trans_seq|int|위버스샵 계정의 재가입 횟수, 2021-11-24일 부터 카운팅하며 첫 가입이면 1|
|29|wv_service_user_key|string|위버스 braze id|
|30|wa_user_id|bigint|위버스앨범 유저ID|
|31|wa_lang|string|위버스앨범 설정언어|
|32|wa_status|string|위버스앨범 회원상태|
|33|wa_cre_dt|timestamp|위버스앨범 가입시간|
|34|wa_deactivated_at|timestamp|위버스앨범 탈퇴시간|
|35|ph_user_id|string|포닝 유저ID|
|36|ph_cre_dt|timestamp|포닝 가입시간|
|37|ph_first_join_dt|timestamp|포닝 최초가입시간|
|38|ph_last_access_at|timestamp|포닝 마지막 접속시간|
|39|ph_withdrawal_at|timestamp|포닝 탈퇴시간|
|40|ws_service_user_key|string|위버스 샵 braze id|
|41|vlive_id|bigint|vlive user_id|
|42|vlive_linked_at|timestamp|vlive 연동시간|
|43|run_timestamp|timestamp|데이터가 insert된 시간|
|44|part_date|string|데이터가 입력된 날짜, string이지만 partition key로 사용|
  
    
---
# HOW TO USE
  
No content.  
---
# PIPELINE INFO

## ⌛️ BATCH

### DAG: `analytics_we_mart_priority_daily`

### Update Interval: DAILY

### Update Type: APPEND

## 📍 LINK URLs

### Github: [Source Code](https://github.com/benxcorp/databricks/blob/main/src/data_analytics/mart/we_mart/we_user.py)

### Airflow: [DAG](https://github.com/benxcorp/dp-airflow/blob/main/dags/utils/dynamic_dag/wev/task_list/analytics_we_mart_priority_daily.py)
  
    
---
# DEPENDENCIES

## 👨‍👩‍👧‍👦 Up/Downstream Table List

|Upstream Tables|Downstream Tables|
| :--- | :--- |
|album.user|we_mart.ph_visit_monthly_base|
|we_mart.ods_ph_fan_user|we_mart.ph_visit_weekly_base|
|we_mart.ods_wemember_user|we_mart.stats_we_d_user_join|
|we_mart.ods_ws_user|we_mart.stats_ws_d_bulk_user_sales|
|we_mart.ods_wv_notification_device|we_mart.stats_ws_d_ord_sale|
|we_mart.ods_wv_user|we_mart.stats_ws_d_survey_reward_smry|
|we_mart.ods_wv_user_last_accessed_at|we_mart.stats_ws_d_survey_user_acqr|
|we_mart.we_user|we_mart.stats_ws_d_survey_user_order|
|we_mart.ws_user_ctry_history|we_mart.stats_wv_d_comm_cross_join_agg|
|we_mart.wv_user_ctry_history|we_mart.stats_wv_d_comm_engage_usr|
|weverse2.community_common_v_member_migration|we_mart.stats_wv_d_digital_code_used|
| |we_mart.stats_wv_d_fanletter_resource|
| |we_mart.stats_wv_d_posting_activity|
| |we_mart.stats_wv_h_digital_prod_sale|
| |we_mart.stats_wv_m_art_cohort_join|
| |we_mart.stats_wv_m_art_cohort_vst|
| |we_mart.stats_wv_m_comm_engage_usr|
| |we_mart.stats_wv_w_art_cohort_vst|
| |we_mart.stats_wv_w_comm_engage_usr|
| |we_mart.wa_user_album_reg|
| |we_mart.we_id_mapping|
| |we_mart.we_jelly_charge|
| |we_mart.we_survey_user|
| |we_mart.we_user|
| |we_mart.we_user_dic_engaged_by_project|
| |we_mart.we_user_light|
| |we_mart.we_visit_monthly|
| |we_mart.we_visit_monthly_base|
| |we_mart.we_visit_weekly_base|
| |we_mart.ws_visit_monthly_base|
| |we_mart.ws_visit_weekly_base|
| |we_mart.wv_artist_follow|
| |we_mart.wv_clog_sess_action|
| |we_mart.wv_clog_sess_impression|
| |we_mart.wv_clog_sess_page|
| |we_mart.wv_comm_user|
| |we_mart.wv_dm_subscr_daily|
| |we_mart.wv_dm_subscr_history|
| |we_mart.wv_fanletter_consume|
| |we_mart.wv_fanletter_voucher|
| |we_mart.wv_jelly_transaction|
| |we_mart.wv_media_reaction|
| |we_mart.wv_order|
| |we_mart.wv_popup_daily|
| |we_mart.wv_post_reaction|
| |we_mart.wv_sess_daily|
| |we_mart.wv_survey_entry|
| |we_mart.wv_ulsm_user_fix|
| |we_mart.wv_ulsm_user_list|
| |we_mart.wv_video_play|
| |we_mart.wv_visit_monthly_base|
| |we_mart.wv_visit_weekly_base|
| |we_mart.wv_vod_play|

## 🐤 Downstream Tables Info
  
No content.  
---
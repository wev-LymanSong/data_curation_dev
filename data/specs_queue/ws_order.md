
we_mart.ws_order
================

# BASIC INFO

|**About**| 담당자 수기 입력 필요 |
| :--- | :--- |
|**Database**|**we_mart**|
|**Table Type**|MART PRIMARY|
|**Partitioned by**|`part_month`|
|**Created/ Last Updated At**|2021-11-29 / 2024-05-03|
|**Created By**|박상민|
|**Last Updated By**|이현지|
|**Collaborators**|이현지[42], 송재영[2], 박상민[2], 임지연[1], 김민정[1], 구민서[1]|
  
#### Change History
|**Date**|**By**|**LINK**|
| :--- | :--- | :--- |
|2021-11-29|박상민|[PR](https://github.com/benxcorp/databricks/commit/8dc809154614d40353684e2d2023adee4ec47cef)|
|2021-12-01|이현지|[PR](https://github.com/benxcorp/databricks/commit/17e39a2a6a3b58d32d2943fb5344034cabe6f96a)|
|2021-12-09|이현지|[PR](https://github.com/benxcorp/databricks/commit/2380d7ad14ce4dd84cae43804df09d8e6fc21ceb)|
|2021-12-13|이현지|[PR](https://github.com/benxcorp/databricks/commit/5aee833cefc072ff168d384bb4ca12e9486fb0df)|
|2022-01-05|이현지|[PR](https://github.com/benxcorp/databricks/commit/8a072028ef98a99ab92d7b24ceb71c055e8626e5)|
|2022-01-12|이현지|[PR](https://github.com/benxcorp/databricks/commit/3f87b072a8786324f51778a86776b521a933ec22)|
|2022-01-13|이현지|[PR](https://github.com/benxcorp/databricks/commit/6d01c03cb147fff791fdef4ff76fb59461b57aee)|
|2022-01-13|박상민|[PR](https://github.com/benxcorp/databricks/commit/d4cb6787c476418e7b480ea8663cd861a0fe7a17)|
|2022-01-13|이현지|[PR](https://github.com/benxcorp/databricks/commit/6653f7f5c8f6cd5fe98f4474db6782d267afa5a4)|
|2022-01-19|이현지|[PR](https://github.com/benxcorp/databricks/commit/6945399dd17fca7cf2abaa925b45a874ad4d7b6a)|
|2022-03-24|이현지|[PR](https://github.com/benxcorp/databricks/commit/1ab5cd1e8fd28be7a6c8d51f8b82b58a5c732022)|
|2022-03-31|이현지|[PR](https://github.com/benxcorp/databricks/commit/99b89bbd07f724f47ae87e25a3a65f422fe3b628)|
|2022-05-19|송재영|[PR](https://github.com/benxcorp/databricks/commit/600c36cca235a57008c8e53f0df5498e1f11b04a)|
|2022-06-09|이현지|[PR](https://github.com/benxcorp/databricks/commit/d1805b6860086326e04ba7cdccec621cb219fc09)|
|2022-07-01|이현지|[PR](https://github.com/benxcorp/databricks/commit/4af476b556e4d91a7df527a3d8b8d0886bec1ac4)|
|2022-07-01|이현지|[PR](https://github.com/benxcorp/databricks/commit/93806cc61fd2b5b1353c65fc4670a9df2bf75f09)|
|2022-07-01|이현지|[PR](https://github.com/benxcorp/databricks/commit/a85d56f15a85f23fab5b43c376ff132723778297)|
|2022-07-04|이현지|[PR](https://github.com/benxcorp/databricks/commit/f20547c57a3c2eb877ea7c9b24a05324338ae1da)|
|2022-07-25|이현지|[PR](https://github.com/benxcorp/databricks/commit/3f3e0ac3b50c035ecb27d8b15ac0d8fe49323979)|
|2022-10-13|이현지|[PR](https://github.com/benxcorp/databricks/commit/e20206b5f52659e7804267878c32568a89278683)|
|2022-10-14|이현지|[PR](https://github.com/benxcorp/databricks/commit/c689c32ad22f9fd4abcda98f2b65d3948e6a3196)|
|2022-11-09|이현지|[PR](https://github.com/benxcorp/databricks/commit/f223510bb8f86608ce344ed9d8ea9291ccf83143)|
|2022-11-16|송재영|[PR](https://github.com/benxcorp/databricks/commit/7c5ab12d2ed3461252d484e62a3e494391ee2d6c)|
|2022-12-09|구민서|[PR](https://github.com/benxcorp/databricks/commit/bd183779c84e616084e05627330a1c8b98ca44bd)|
|2022-12-12|이현지|[PR](https://github.com/benxcorp/databricks/commit/826680a217711a14844d4970c26e1f1f5d34b0a4)|
|2022-12-12|이현지|[PR](https://github.com/benxcorp/databricks/commit/224c76fda4efedf027b236a2857575e1c426a25f)|
|2022-12-22|이현지|[PR](https://github.com/benxcorp/databricks/commit/c1d918ef362e46ea23d4a14be2f8694abc985ff0)|
|2022-12-22|이현지|[PR](https://github.com/benxcorp/databricks/commit/c9b19b2c04f21aa081635fd4cdfb22dab6ac3310)|
|2023-01-30|이현지|[PR](https://github.com/benxcorp/databricks/commit/3329db11a3ac8d5b4dbc16869289b061f8d7451b)|
|2023-02-02|이현지|[PR](https://github.com/benxcorp/databricks/commit/5a943b91e72f7f105dce9f7f55ce393d2248e5e4)|
|2023-02-03|이현지|[PR](https://github.com/benxcorp/databricks/commit/13fe0c2dc9eb154afa455de977af2e2911aa0f07)|
|2023-02-03|이현지|[PR](https://github.com/benxcorp/databricks/commit/e1700376c258ff23f3a3ffda6bd049ca2d570ec9)|
|2023-02-03|이현지|[PR](https://github.com/benxcorp/databricks/commit/ec29fb73dbaa8762e8905cd08fa65636677149d4)|
|2023-02-03|이현지|[PR](https://github.com/benxcorp/databricks/commit/1ee15351ddea9bf6e1fe5365b67dc272dbfb6f6f)|
|2023-03-06|이현지|[PR](https://github.com/benxcorp/databricks/commit/9bd817820b41548476ef3f458d80e5db724cdf3c)|
|2023-09-13|이현지|[PR](https://github.com/benxcorp/databricks/commit/c881a709360da4152072f58a5b1fa27f1b5ad6ae)|
|2023-09-18|이현지|[PR](https://github.com/benxcorp/databricks/commit/1ab3a6b086402d48b0056e2c899e401ef495444f)|
|2023-09-21|이현지|[PR](https://github.com/benxcorp/databricks/commit/a0a52ec622c06737ea76ed9a0e1a07377e143fbd)|
|2023-09-21|이현지|[PR](https://github.com/benxcorp/databricks/commit/6cda9d7ee5bb6387ed250db599aabce0ec86ada9)|
|2023-11-14|김민정|[PR](https://github.com/benxcorp/databricks/commit/1a8600c29277eb2f98f7601f08478367c27b3b67)|
|2023-12-28|이현지|[PR](https://github.com/benxcorp/databricks/commit/a45b71880622807a2772bc2c9c0c8e9f3755453c)|
|2024-02-02|임지연|[PR](https://github.com/benxcorp/databricks/commit/19d90ee6d6b71316423df597a01937443bf3c5c6)|
|2024-03-19|이현지|[PR](https://github.com/benxcorp/databricks/commit/498fef12c553ef095d33b8d20e2e1f49ca085bbc)|
|2024-03-19|이현지|[PR](https://github.com/benxcorp/databricks/commit/ee962a3adc6b02e130aad954ffc6efe1e389808b)|
|2024-03-19|이현지|[PR](https://github.com/benxcorp/databricks/commit/8970cec2866970653e77476c8973ede1cd0e137b)|
|2024-03-19|이현지|[PR](https://github.com/benxcorp/databricks/commit/b82956bad73156ca3144949d6a48c4d5ff3057d5)|
|2024-03-19|이현지|[PR](https://github.com/benxcorp/databricks/commit/2bf4c67f4cbb6f64c7f841908e60914cc3b9271a)|
|2024-04-18|이현지|[PR](https://github.com/benxcorp/databricks/commit/92ee41a9e2781464649945ca17c39ac82a255901)|
|2024-05-03|이현지|[PR](https://github.com/benxcorp/databricks/commit/bda74be725f67d3254b1d9dd0321838e8a4c2f7a)|
  
  
# TABLE NOTICE
  
### 테이블 개요

* **테이블 목적**: 위버스샵 주문 데이터를 기반으로, 주문, 결제, 배송, 취소/환불 정보와 상품, 아티스트, 멤버십 정보를 통합하여 분석에 필요한 데이터를 제공
* **데이터 레벨**: TRANSACTIONAL DATA
* **파티션 키**: `part_month`
* **주요 키**: `ord_item_id`

### 테이블 특징

* `we_member_id`와 `ws_user_id`를 사용하여 위버스 플랫폼과 위버스샵 사용자 간의 연결성을 파악
* `is_fc`, `pay_seq`, `pay_ok_seq`를 통해 멤버십 상태, 결제 성공 순번, 결제 성공 및 주문 완료 순번을 추적
* `ord_item_amt_krw`, `ord_item_cx_amt_krw`와 같은 컬럼을 통해 KRW 기준 주문/취소 금액을 확인
* `ship_cost_type` 컬럼을 통해 배송 비용 유형(무료/유료)을 구분

### 데이터 추출 및 생성 과정

1.  **주요 데이터 소스**:
    *   `we_mart.ods_ws_order_item`: 위버스샵 주문 상품 정보
    *   `we_mart.ods_ws_payment_transaction`: 위버스샵 결제 정보
    *   `we_mart.ods_ws_order_sheet`: 위버스샵 주문 정보
    *   `we_mart.ods_ws_shipping_group`: 위버스샵 배송 그룹 정보
    *   `weverseshop.delivery_service`: 위버스샵 배송 서비스 정보
    *   `weverseshop.express_courier`: 위버스샵 특송사 정보
    *   `we_mart.ws_goods_stock`: 위버스샵 상품 재고 정보
    *   `we_mart.ods_ws_user`: 위버스샵 사용자 정보
    *   `we_mart.we_id_mapping`: 위버스 플랫폼과 위버스샵 사용자 ID 매핑 정보
    *   `weverseshop.order_item_release`: 위버스샵 주문 상품 발매 정보
    *   `we_mart.ws_fc_user_history`: 위버스샵 멤버십 정보
    *   `we_meta.currency_rate`: 환율 정보
    *   `wev_prod.weverseshop.order_item_history`: 위버스샵 주문 상품 이력 정보
2.  **데이터 전처리**:
    *   `order_item`, `payment_transaction`, `user_ctry_history`, `currency_rate`, `order_sheet`, `fc_user_history`, `cx_order_item` 등의 뷰 테이블 생성
    *   `we_mart.ods_ws_order_item`에서 `part_date`를 기준으로 최근 2년치 데이터만 추출
    *   `wev_prod.weverseshop.order_item_history`에서 `status`가 특정 값인 데이터 중 최초 생성된 데이터만 추출
    *   `we_mart.ods_ws_order_sheet`와 `user_ctry_history`를 `user_id`와 `created_at`를 기준으로 조인하여 사용자의 국가 정보를 추가
    *   `we_mart.ws_fc_user_history`에서 `is_cx_by_restore`가 0이고 `ord_status`가 `PAYMENT_FAILED`가 아닌 데이터만 추출
3.  **데이터 통합**:
    *   위의 뷰 테이블들을 `order_item_id`, `order_sheet_id`, `we_member_id`, `sale_id`, `goods_id`, `goods_option_code`, `created_at` 등의 컬럼을 기준으로 조인
    *   `is_pay`, `is_pay_waiting`, `is_pay_waiting_exceed`, `is_status_ok`, `is_cx`, `is_admin_ord`, `is_exch_ord` 등의 컬럼을 추가하여 주문 상태 정보를 표현
    *   `ord_item_amt_krw`, `ord_item_cx_amt_krw` 컬럼을 생성하여 KRW 기준 주문/취소 금액을 계산
    *   `ship_cost_type` 컬럼을 생성하여 배송 비용 유형을 구분
4.  **최종 테이블 생성**:
    *   위의 데이터 통합 결과를 `we_mart.ws_order` 테이블에 저장
    *   `part_month` 컬럼을 파티션 키로 사용

### 테이블 활용 가이드

* **주요 활용**:
    *   위버스샵 주문 데이터 분석
    *   멤버십 구매 분석
    *   상품별 판매 분석
    *   국가별 주문 분석
    *   결제 성공률 분석
    *   취소/환불 분석
* **조인 시 유의사항**:
    *   `we_member_id`와 `ws_user_id`를 사용하여 위버스 플랫폼과 위버스샵 사용자 간의 연결성을 고려해야 함
    *   `is_fc` 컬럼을 사용하여 멤버십 상태를 고려해야 함
    *   `pay_seq`, `pay_ok_seq` 컬럼을 사용하여 결제 성공 순번 및 결제 성공 & 주문 완료 순번을 고려해야 함

### 추가 정보

*   `we_mart.ws_order` 테이블은 `part_month` 컬럼을 파티션 키로 사용하여 데이터를 관리
*   `we_mart.ws_order` 테이블은 `we_member_id`, `ws_user_id`, `ord_item_id`, `sale_id`, `goods_id`, `goods_option_code` 등의 컬럼을 사용하여 다양한 테이블과 조인 가능
*   `we_mart.ws_order` 테이블은 위버스샵 주문 데이터를 분석하는 데 유용한 정보를 제공
*   `we_mart.ws_order` 테이블은 위버스샵 주문 데이터 분석 시 필수적으로 참조해야 하는 테이블  
---
# COLUMN INFO

|#|Column Name|Data Type|Comment|
| :--- | :--- | :--- | :--- |
|0|run_timestamp|timestamp| |
|1|ord_cre_dt|timestamp|주문생성일|
|2|ord_upd_dt|timestamp|주문업데이트일|
|3|pay_dt|timestamp|결제업데이트일(결제완료일로 간주)|
|4|cx_dt|timestamp|취소일시|
|5|deliv_completed_dt|timestamp|배송완료일|
|6|we_member_id|bigint|we_member_id|
|7|ws_user_id|bigint|위버스샵 user id|
|8|is_fc|int|구매시 멤버십 상태 여부|
|9|pay_seq|int|결제성공 순번|
|10|pay_ok_seq|int|결제성공 & 주문완료상태 순번|
|11|shop|string|shop|
|12|ord_sheet_id|bigint|주문 id|
|13|ord_sheet_number|bigint|주문번호|
|14|ord_item_id|bigint|주문상품 id|
|15|sale_id|bigint|판매 id|
|16|sale_stock_id|bigint|판매상품 옵션 id|
|17|goods_id|bigint|상품 id|
|18|goods_code|string|상품 code|
|19|goods_option_id|bigint|상품 옵션 id|
|20|goods_option_code|string|상품 옵션 code|
|21|sap_code|string|sap code|
|22|project_code|string|POD 프로젝트 코드|
|23|we_art_id|int|아티스트 id|
|24|goods_upr_cat_id|bigint|상위카테고리 id|
|25|goods_lwr_cat_id|bigint|하위카테고리 id|
|26|ship_group_id|bigint|배송그룹 id|
|27|deliv_service_id|bigint|배송사 id|
|28|we_art_name|string|아티스트명|
|29|goods_upr_cat_name|string|상위카테고리|
|30|goods_lwr_cat_name|string|하위카테고리|
|31|goods_cat|string|상품구분|
|32|logi_cat|string|물류 카테고리|
|33|goods_name|string|상품명|
|34|goods_option_name|string|상품 옵션명|
|35|is_pay|int|결제여부|
|36|is_pay_waiting|int|편의점 결제 펜딩 여부|
|37|is_pay_waiting_exceed|int|편의점 결제 입금일 초과 여부|
|38|is_status_ok|int|주문완료상태 여부|
|39|is_cx|int|취소/환불 여부|
|40|is_admin_ord|int|수기주문 여부 (1: 수기 주문, 0: 정상 주문 )|
|41|is_exch_ord|int|교환주문 여부 (1: 교환 주문, 0: 정상 주문)|
|42|ord_status|string|주문상태|
|43|ord_item_qty|int|주문상품 수량|
|44|ord_item_cx_qty|int|취소/환불상품 수량|
|45|ord_item_amt|double|주문상품 금액|
|46|ord_item_amt_krw|double|주문상품 금액 (KRW)|
|47|ord_item_cx_amt|double|취소/환불상품 금액|
|48|ord_item_cx_amt_krw|double|취소/환불상품 금액 (KRW)|
|49|sale_price|double|판매금액|
|50|album_qty|int|앨범수량|
|51|currency_code|string|통화|
|52|currency_rate|double|환율|
|53|device_type|string|클라이언트 플랫폼|
|54|ship_ctry_code|string|배송국가코드|
|55|ship_prov_area|string|배송 state / Province|
|56|ship_group_name|string|배송그룹 이름|
|57|deliv_service_name|string|배송사 이름|
|58|deliv_express_code|string|특송사 코드|
|59|logi_type|string|물류사|
|60|ship_postal_code|string|우편번호|
|61|deliv_status|string|배송상태|
|62|ship_cost_type|string|배송 구분|
|63|pay_gateway|string|결제 PG사 (KCP, PAYPAL)|
|64|pay_method|string|결제 수단|
|65|pay_card_type|string|결제 신용카드 종류|
|66|pay_mobile_provider|string|결제 모바일 통신사|
|67|ctry_code|string|user 국가코드|
|68|ip|string|user ip|
|69|trade_co_name|string|거래처|
|70|bm_option|string|bm_option|
|71|pod_option_sell_code|string|POD 상품 옵션 판매 코드|
|72|pod_template_code|string|POD 템플릿 코드|
|73|part_month|string| |
  
    
---
# HOW TO USE
  
### Downstream Table/View
- `we_member_id` 컬럼을 파티션 키로 활용하여 `we_mart.ws_order` 테이블을 파티션
    - ```sql
      create or replace table we_mart.ws_order_by_member
      (
      run_timestamp	timestamp
      ,	ord_cre_dt	timestamp	comment	'주문생성일'
      ,	ord_upd_dt	timestamp	comment	'주문업데이트일'
      ,	pay_dt	timestamp	comment	'결제업데이트일(결제완료일로 간주)'
      ,	cx_dt	timestamp	comment	'최초 취소일시'
      ,	deliv_completed_date	timestamp	comment	'배송완료일'
      ,	we_member_id	bigint	comment	'we_member_id'
      ,	ws_user_id	bigint	comment	'위버스샵 user id'
      ,	is_fc	int	comment	'구매시 멤버십 상태 여부'
      ,	pay_seq	int	comment	'결제성공 순번'
      ,	pay_ok_seq	int	comment	'결제성공 & 주문완료상태 순번'
      ,	shop	string	comment	'shop'
      ,	ord_sheet_id	bigint	comment	'주문 id'
      ,	ord_sheet_number	bigint	comment	'주문번호'
      ,	ord_item_id	bigint	comment	'주문상품 id'
      ,	sale_id	bigint	comment	'판매 id'
      ,	sale_stock_id bigint comment '판매상품 옵션 id'
      ,	goods_id	bigint	comment	'상품 id'
      ,	goods_code	string	comment	'상품 code'
      ,	goods_option_id	bigint	comment	'상품 옵션 id'
      ,	goods_option_code	string	comment	'상품 옵션 code'
      ,	sap_code	string	comment	'sap code'
      ,	we_art_id	int	comment	'아티스트 id'
      ,	goods_upr_cat_id	bigint	comment	'상위카테고리 id'
      ,	goods_lwr_cat_id	bigint	comment	'하위카테고리 id'
      ,	ship_group_id	bigint	comment	'배송그룹 id'
      ,	deliv_service_id	bigint	comment	'배송사 id'
      ,	we_art_name	string	comment	'아티스트명'
      ,	goods_upr_cat_name	string	comment	'상위카테고리'
      ,	goods_lwr_cat_name	string	comment	'하위카테고리'
      ,	goods_cat	string	comment	'상품구분'
      ,	logi_cat	string	comment '물류 카테고리'
      ,	goods_name	string	comment	'상품명'
      ,	goods_option_name string comment '상품 옵션명'
      ,	is_pay	int	comment	'결제여부'
      ,	is_pay_waiting int comment '편의점 결제 펜딩 여부'
      ,	is_pay_waiting_exceed int comment '편의점 결제 입금일 초과 여부'
      ,	is_status_ok	int	comment	'주문완료상태 여부'
      ,	is_cx	int comment '취소/환불 여부'
      ,	is_admin_ord	int	comment	'수기주문 여부 (1: 수기 주문, 0: 정상 주문 )'
      ,	is_exch_ord	int	comment	'교환주문 여부 (1: 교환 주문, 0: 정상 주문)'
      ,	ord_status	string	comment	'주문상태'
      ,	ord_item_qty	int	comment	'주문상품 수량'
      ,	ord_item_cx_qty	int	comment	'취소/환불상품 수량'
      ,	ord_item_amt	double	comment	'주문상품 금액'
      ,	ord_item_amt_krw	double	comment	'주문상품 금액 (KRW)'
      ,	ord_item_cx_amt	double	comment	'취소/환불상품 금액'
      ,	ord_item_cx_amt_krw	double	comment	'취소/환불상품 금액 (KRW)'
      ,	sale_price	double	comment	'판매금액'
      ,	album_qty	int	comment	'앨범수량'
      ,	currency_code	string	comment	'통화'
      ,	currency_rate	double	comment	'환율'
      ,	device_type	string	comment	'클라이언트 플랫폼'
      ,	ship_ctry_code	string	comment	'배송국가코드'
      ,	ship_prov_area	string	comment	'배송 state / Province'
      ,	ship_group_name	string	comment	'배송그룹 이름'
      ,	deliv_service_name	string	comment	'배송사 이름'
      ,	deliv_express_code	string	comment	'특송사 코드'
      ,	logistics_type	string	comment	'물류사'
      ,	shipping_postal_code	string	comment	'우편번호'
      ,	delivery_status	string	comment	'배송상태'
      ,	ship_cost_type 	string	comment	'배송 구분'
      ,	payment_gateway	string	comment	'결제 PG사 (KCP, PAYPAL)'
      ,	payment_method	string	comment	'결제 수단'
      ,	pay_card_type	string	comment	'결제 신용카드 종류'
      ,	pay_mobile_provider string comment  '결제 모바일 통신사'
      ,	ctry_code	string	comment	'user 국가코드'
      ,	ip	string	comment	'user ip'
      ,	trade_co_name	string	comment	'거래처'
      ,	bm_option                                         as bm_option
      ,	pod_option_sell_code                              as pod_option_sell_code
      ,	pod_template_code                                 as pod_template_code
      ,	part_month                                        as part_month
      )
      using DELTA
      partitioned by (we_member_id)
      comment '위버스샵 주문상품정보 마트'
      ```
- `we_mart.ws_order` 테이블과 `we_mart.ws_goods_stock` 테이블을 `sale_id` 와 `goods_option_code` 컬럼을 이용하여 조인
    - ```sql
      select o.ord_sheet_number, g.goods_name, g.goods_upr_cat_name, g.goods_lwr_cat_name
      from we_mart.ws_order o
      join we_mart.ws_goods_stock g on o.sale_id = g.sale_id and o.goods_option_code = g.goods_option_code
      where o.shop = 'GL'
      ```
- `we_mart.ws_order` 테이블과 `we_mart.ws_fc_user_history` 테이블을 `we_member_id` 와 `we_art_id` 컬럼을 이용하여 조인
    - ```sql
      select o.ord_sheet_number, f.fc_name, f.create_dt, f.expire_dt
      from we_mart.ws_order o
      join we_mart.ws_fc_user_history f on o.we_member_id = f.we_member_id and o.we_art_id = f.we_art_id
      where o.shop = 'GL'
      and o.is_fc = 1
      ```

### Data Extraction
- `we_art_id` 가 "ARTIST" 이고 `goods_cat` 이 "MEMBERSHIP" 인 상품들의 주문 정보를 추출
    - ```sql
      select ord_sheet_number, ord_item_id, goods_name, ord_item_qty, ord_item_amt, ord_cre_dt, pay_dt
      from we_mart.ws_order
      where we_art_id = 'ARTIST'
      and goods_cat = 'MEMBERSHIP'
      ```
- "2024-01-01" 이후 "2024-01-15" 까지의 주문 중, `is_pay` 가 1 이고 `is_cx` 가 0 인 주문 데이터를 추출
    - ```sql
      select ord_sheet_number, ord_item_id, goods_name, ord_item_qty, ord_item_amt, ord_cre_dt, pay_dt
      from we_mart.ws_order
      where ord_cre_dt >= '2024-01-01'
      and ord_cre_dt <= '2024-01-15'
      and is_pay = 1
      and is_cx = 0
      ```
- "2024-01-01" 이후 "2024-01-15" 까지의 주문 중, `is_pay` 가 1 이고 `is_cx` 가 1 인 주문 데이터를 추출
    - ```sql
      select ord_sheet_number, ord_item_id, goods_name, ord_item_qty, ord_item_amt, ord_cre_dt, pay_dt, cx_dt
      from we_mart.ws_order
      where ord_cre_dt >= '2024-01-01'
      and ord_cre_dt <= '2024-01-15'
      and is_pay = 1
      and is_cx = 1
      ```
- "2024-01-01" 이후 "2024-01-15" 까지의 주문 중, `is_pay` 가 1 이고 `is_cx` 가 0 이며, `shop` 이 "GL" 인 주문 데이터를 추출
    - ```sql
      select ord_sheet_number, ord_item_id, goods_name, ord_item_qty, ord_item_amt, ord_cre_dt, pay_dt
      from we_mart.ws_order
      where ord_cre_dt >= '2024-01-01'
      and ord_cre_dt <= '2024-01-15'
      and is_pay = 1
      and is_cx = 0
      and shop = 'GL'
      ```
- "2024-01-01" 이후 "2024-01-15" 까지의 주문 중, `is_pay` 가 1 이고 `is_cx` 가 0 이며, `shop` 이 "GL" 이고, `goods_cat` 이 "MEMBERSHIP" 인 주문 데이터를 추출
    - ```sql
      select ord_sheet_number, ord_item_id, goods_name, ord_item_qty, ord_item_amt, ord_cre_dt, pay_dt
      from we_mart.ws_order
      where ord_cre_dt >= '2024-01-01'
      and ord_cre_dt <= '2024-01-15'
      and is_pay = 1
      and is_cx = 0
      and shop = 'GL'
      and goods_cat = 'MEMBERSHIP'
      ```  
---
# PIPELINE INFO

## ⌛️ BATCH

### DAG: `analytics_ws_mart_daily`

### Update Interval: DAILY

### Update Type: OVERWRITE

## 📍 LINK URLs

### Github: [Source Code](https://github.com/benxcorp/databricks/blob/main/src/data_analytics/mart/we_mart/ws_order.py)

### Airflow: [DAG](https://github.com/benxcorp/dp-airflow/blob/main/dags/utils/dynamic_dag/wev/task_list/analytics_ws_mart_daily.py)
  
    
---
# DEPENDENCIES

## 👨‍👩‍👧‍👦 Up/Downstream Table List

|Upstream Tables|Downstream Tables|
| :--- | :--- |
|we_mart.ods_ws_order_item|we_mart.stats_wa_d_album_reg_smry|
|we_mart.ods_ws_order_sheet|we_mart.stats_we_d_integ_visit|
|we_mart.ods_ws_payment_transaction|we_mart.stats_we_m_order_first|
|we_mart.ods_ws_shipping_group|we_mart.stats_we_m_order_first_seq|
|we_mart.ods_ws_user|we_mart.stats_ws_d_album_cross_ord_by_art|
|we_mart.we_id_mapping|we_mart.stats_ws_d_album_cumul|
|we_mart.ws_fc_user_history|we_mart.stats_ws_d_album_cumul_age|
|we_mart.ws_goods_stock|we_mart.stats_ws_d_album_cumul_kpi|
|we_mart.ws_order|we_mart.stats_ws_d_album_retention|
|we_mart.ws_user_ctry_history|we_mart.stats_ws_d_deliv|
|we_meta.currency_rate|we_mart.stats_ws_d_deliv_days|
|weverseshop.delivery_service|we_mart.stats_ws_d_deliv_ok|
|weverseshop.express_courier|we_mart.stats_ws_d_funnel_detail|
|weverseshop.order_item_history|we_mart.stats_ws_d_ord_amt|
|weverseshop.order_item_release|we_mart.stats_ws_d_ord_rate|
| |we_mart.stats_ws_d_ord_shop_integ|
| |we_mart.stats_ws_d_ord_us|
| |we_mart.stats_ws_d_survey_user_acqr|
| |we_mart.stats_ws_d_survey_user_order|
| |we_mart.stats_ws_d_user_platform|
| |we_mart.stats_ws_h_ord_product_concert|
| |we_mart.stats_ws_h_ord_product_detail|
| |we_mart.stats_ws_m_ord_deliv_complete|
| |we_mart.stats_wv_d_media_sale|
| |we_mart.stats_wv_d_media_sale_cp|
| |we_mart.view_ipx_ws_order|
| |we_mart.view_wej_ws_order|
| |we_mart.view_ws_pod_order|
| |we_mart.we_fan_order|
| |we_mart.we_l2s_order|
| |we_mart.we_order|
| |we_mart.we_user_dic_engaged_by_project|
| |we_mart.ws_album_sale|
| |we_mart.ws_l2s_order|
| |we_mart.ws_ord_raffle|
| |we_mart.ws_order|
| |we_mart.ws_platform_daily|
| |we_mart.ws_pod_order_history|
| |we_mart.ws_pod_order_resource|

## 🐤 Downstream Tables Info
  
### Downstream Tables
- **we_order** : Weverse 통합 주문 정보를 담은 테이블
    - ws_order 테이블에서 주문, 결제, 취소 정보를 가져와서 가공하여 저장함
    - `product_source`, `is_pay`, `is_cx`, `is_fc`, `pay_dt`, `cx_dt`, `pay_amt_krw`, `pay_amt`, `cx_amt_krw`, `cx_amt`, `we_art_id`, `we_art_name`, `shop`, `product_type`, `ord_sheet_number`, `transaction_id`, `ord_item_id`, `sale_id`, `sale_price`, `sale_currency_code`, `wbs_code`, `sap_code`, `pay_system`, `pay_method`, `goods_code`, `goods_option_id`, `goods_option_code`, `goods_name`, `goods_option_name`, `goods_upr_cat_id`, `goods_lwr_cat_id`, `goods_upr_cat_name`, `goods_lwr_cat_name`, `dur_type`, `dur_unit`, `dur_value`, `promotion_type`, `promotion_unit`, `promotion_value`, `album_qty`, `logi_cat`, `ship_ctry_code`, `ship_cost_type`, `device_type`, `trade_co_name`, `pay_card_type`, `pay_mobile_provider`, `pay_seq`, `we_pay_seq`, `fc_id`, `fc_name` 컬럼을 사용
    - 특정 기간 동안 특정 아티스트의 상품 구매 정보를 추출할 때 사용
- **we_l2s_order** : L2S 관련 상품 판매 및 라이브 시청 정보를 담은 테이블
    - ws_order 테이블에서 L2S 상품에 대한 주문 정보를 가져와서 가공하여 저장함
    - `live_post_id`, `live_title`, `live_view_type`, `date_type`, `trx_type`, `we_member_id`, `ctry_code`, `ord_sheet_number`, `ord_item_id`, `shop`, `sale_id`, `sale_stock_id`, `goods_name`, `goods_option_name`, `we_art_id`, `we_art_name`, `album_qty`, `currency_code`, `pay_qty`, `pay_amt`, `pay_krw`, `cx_qty`, `cx_amt`, `cx_krw`, `is_sale_pu`, `is_sale_net_pu`, `is_live_pu`, `is_live_net_pu`, `live_start_dt`, `live_end_dt`, `l2s_sale_start_dt`, `l2s_sale_end_dt` 컬럼을 사용
    - 특정 라이브 방송 기간 동안 상품 구매 정보와 라이브 시청 정보를 함께 추출할 때 사용
- **ws_pod_order_resource** : 주문상품별 사용 리소스 정보를 담은 테이블
    - ws_order 테이블에서 POD 상품에 대한 주문 정보를 가져와서 가공하여 저장함
    - `pod_resource_id`, `resource_category`, `resource_category_code`, `type`, `sub_type`, `keyword`, `resource_qty` 컬럼을 사용
    - 특정 POD 상품에 대한 주문 건 별 사용된 리소스 정보를 추출할 때 사용

### Downstream View Tables
- **None** : 해당 테이블은 view 테이블을 사용하지 않음  
---